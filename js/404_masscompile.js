/**
 * two.js
 * a two-dimensional drawing api meant for modern browsers. It is renderer
 * agnostic enabling the same api for rendering in multiple contexts: webgl,
 * canvas2d, and svg.
 *
 * Copyright (c) 2012 - 2016 jonobr1 / http://jonobr1.com
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

(function(){function x(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=p(d,f,4);var g=!w(c)&&o.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function A(a){return function(b,c,d){c=q(c,d);for(var e=v(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function B(a,b,c){return function(d,e,f){var h=0,i=v(d);if("number"==typeof f)a>0?h=f>=0?f:Math.max(f+i,h):i=f>=0?Math.min(f+1,i):f+i+1;else if(c&&f&&i)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(g.call(d,h,i),o.isNaN),f>=0?f+h:-1;for(f=a>0?h:i-1;f>=0&&i>f;f+=a)if(d[f]===e)return f;return-1}}function F(a,b){var c=E.length,e=a.constructor,f=o.isFunction(e)&&e.prototype||d,g="constructor";for(o.has(a,g)&&!o.contains(b,g)&&b.push(g);c--;)g=E[c],g in a&&a[g]!==f[g]&&!o.contains(b,g)&&b.push(g)}var a=this,b=a._,c=Array.prototype,d=Object.prototype,e=Function.prototype,f=c.push,g=c.slice,h=d.toString,i=d.hasOwnProperty,j=Array.isArray,k=Object.keys,l=e.bind,m=Object.create,n=function(){},o=function(a){return a instanceof o?a:this instanceof o?void(this._wrapped=a):new o(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=o),exports._=o):a._=o,o.VERSION="1.8.3";var p=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},q=function(a,b,c){return null==a?o.identity:o.isFunction(a)?p(a,b,c):o.isObject(a)?o.matcher(a):o.property(a)};o.iteratee=function(a,b){return q(a,b,1/0)};var r=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},s=function(a){if(!o.isObject(a))return{};if(m)return m(a);n.prototype=a;var b=new n;return n.prototype=null,b},t=function(a){return function(b){return null==b?void 0:b[a]}},u=Math.pow(2,53)-1,v=t("length"),w=function(a){var b=v(a);return"number"==typeof b&&b>=0&&u>=b};o.each=o.forEach=function(a,b,c){b=p(b,c);var d,e;if(w(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=o.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},o.map=o.collect=function(a,b,c){b=q(b,c);for(var d=!w(a)&&o.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},o.reduce=o.foldl=o.inject=x(1),o.reduceRight=o.foldr=x(-1),o.find=o.detect=function(a,b,c){var d;return d=w(a)?o.findIndex(a,b,c):o.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},o.filter=o.select=function(a,b,c){var d=[];return b=q(b,c),o.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},o.reject=function(a,b,c){return o.filter(a,o.negate(q(b)),c)},o.every=o.all=function(a,b,c){b=q(b,c);for(var d=!w(a)&&o.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},o.some=o.any=function(a,b,c){b=q(b,c);for(var d=!w(a)&&o.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},o.contains=o.includes=o.include=function(a,b,c,d){return w(a)||(a=o.values(a)),("number"!=typeof c||d)&&(c=0),o.indexOf(a,b,c)>=0},o.invoke=function(a,b){var c=g.call(arguments,2),d=o.isFunction(b);return o.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},o.pluck=function(a,b){return o.map(a,o.property(b))},o.where=function(a,b){return o.filter(a,o.matcher(b))},o.findWhere=function(a,b){return o.find(a,o.matcher(b))},o.max=function(a,b,c){var f,g,d=-(1/0),e=-(1/0);if(null==b&&null!=a){a=w(a)?a:o.values(a);for(var h=0,i=a.length;i>h;h++)f=a[h],f>d&&(d=f)}else b=q(b,c),o.each(a,function(a,c,f){g=b(a,c,f),(g>e||g===-(1/0)&&d===-(1/0))&&(d=a,e=g)});return d},o.min=function(a,b,c){var f,g,d=1/0,e=1/0;if(null==b&&null!=a){a=w(a)?a:o.values(a);for(var h=0,i=a.length;i>h;h++)f=a[h],d>f&&(d=f)}else b=q(b,c),o.each(a,function(a,c,f){g=b(a,c,f),(e>g||g===1/0&&d===1/0)&&(d=a,e=g)});return d},o.shuffle=function(a){for(var f,b=w(a)?a:o.values(a),c=b.length,d=Array(c),e=0;c>e;e++)f=o.random(0,e),f!==e&&(d[e]=d[f]),d[f]=b[e];return d},o.sample=function(a,b,c){return null==b||c?(w(a)||(a=o.values(a)),a[o.random(a.length-1)]):o.shuffle(a).slice(0,Math.max(0,b))},o.sortBy=function(a,b,c){return b=q(b,c),o.pluck(o.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var y=function(a){return function(b,c,d){var e={};return c=q(c,d),o.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};o.groupBy=y(function(a,b,c){o.has(a,c)?a[c].push(b):a[c]=[b]}),o.indexBy=y(function(a,b,c){a[c]=b}),o.countBy=y(function(a,b,c){o.has(a,c)?a[c]++:a[c]=1}),o.toArray=function(a){return a?o.isArray(a)?g.call(a):w(a)?o.map(a,o.identity):o.values(a):[]},o.size=function(a){return null==a?0:w(a)?a.length:o.keys(a).length},o.partition=function(a,b,c){b=q(b,c);var d=[],e=[];return o.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},o.first=o.head=o.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:o.initial(a,a.length-b)},o.initial=function(a,b,c){return g.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},o.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:o.rest(a,Math.max(0,a.length-b))},o.rest=o.tail=o.drop=function(a,b,c){return g.call(a,null==b||c?1:b)},o.compact=function(a){return o.filter(a,o.identity)};var z=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=v(a);h>g;g++){var i=a[g];if(w(i)&&(o.isArray(i)||o.isArguments(i))){b||(i=z(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};o.flatten=function(a,b){return z(a,b,!1)},o.without=function(a){return o.difference(a,g.call(arguments,1))},o.uniq=o.unique=function(a,b,c,d){o.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=q(c,d));for(var e=[],f=[],g=0,h=v(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?o.contains(f,j)||(f.push(j),e.push(i)):o.contains(e,i)||e.push(i)}return e},o.union=function(){return o.uniq(z(arguments,!0,!0))},o.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=v(a);e>d;d++){var f=a[d];if(!o.contains(b,f)){for(var g=1;c>g&&o.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},o.difference=function(a){var b=z(arguments,!0,!0,1);return o.filter(a,function(a){return!o.contains(b,a)})},o.zip=function(){return o.unzip(arguments)},o.unzip=function(a){for(var b=a&&o.max(a,v).length||0,c=Array(b),d=0;b>d;d++)c[d]=o.pluck(a,d);return c},o.object=function(a,b){for(var c={},d=0,e=v(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},o.findIndex=A(1),o.findLastIndex=A(-1),o.sortedIndex=function(a,b,c,d){c=q(c,d,1);for(var e=c(b),f=0,g=v(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},o.indexOf=B(1,o.findIndex,o.sortedIndex),o.lastIndexOf=B(-1,o.findLastIndex),o.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var C=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=s(a.prototype),g=a.apply(f,e);return o.isObject(g)?g:f};o.bind=function(a,b){if(l&&a.bind===l)return l.apply(a,g.call(arguments,1));if(!o.isFunction(a))throw new TypeError("Bind must be called on a function");var c=g.call(arguments,2),d=function(){return C(a,d,b,this,c.concat(g.call(arguments)))};return d},o.partial=function(a){var b=g.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===o?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return C(a,c,this,this,f)};return c},o.bindAll=function(a){var b,d,c=arguments.length;if(1>=c)throw new Error("bindAll must be passed function names");for(b=1;c>b;b++)d=arguments[b],a[d]=o.bind(a[d],a);return a},o.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return o.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},o.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},o.defer=o.partial(o.delay,o,1),o.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:o.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=o.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},o.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=o.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=o.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},o.wrap=function(a,b){return o.partial(b,a)},o.negate=function(a){return function(){return!a.apply(this,arguments)}},o.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},o.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},o.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},o.once=o.partial(o.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];o.keys=function(a){if(!o.isObject(a))return[];if(k)return k(a);var b=[];for(var c in a)o.has(a,c)&&b.push(c);return D&&F(a,b),b},o.allKeys=function(a){if(!o.isObject(a))return[];var b=[];for(var c in a)b.push(c);return D&&F(a,b),b},o.values=function(a){for(var b=o.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},o.mapObject=function(a,b,c){b=q(b,c);for(var g,d=o.keys(a),e=d.length,f={},h=0;e>h;h++)g=d[h],f[g]=b(a[g],g,a);return f},o.pairs=function(a){for(var b=o.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},o.invert=function(a){for(var b={},c=o.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},o.functions=o.methods=function(a){var b=[];for(var c in a)o.isFunction(a[c])&&b.push(c);return b.sort()},o.extend=r(o.allKeys),o.extendOwn=o.assign=r(o.keys),o.findKey=function(a,b,c){b=q(b,c);for(var e,d=o.keys(a),f=0,g=d.length;g>f;f++)if(e=d[f],b(a[e],e,a))return e},o.pick=function(a,b,c){var f,g,d={},e=a;if(null==e)return d;o.isFunction(b)?(g=o.allKeys(e),f=p(b,c)):(g=z(arguments,!1,!1,1),f=function(a,b,c){return b in c},e=Object(e));for(var h=0,i=g.length;i>h;h++){var j=g[h],k=e[j];f(k,j,e)&&(d[j]=k)}return d},o.omit=function(a,b,c){if(o.isFunction(b))b=o.negate(b);else{var d=o.map(z(arguments,!1,!1,1),String);b=function(a,b){return!o.contains(d,b)}}return o.pick(a,b,c)},o.defaults=r(o.allKeys,!0),o.create=function(a,b){var c=s(a);return b&&o.extendOwn(c,b),c},o.clone=function(a){return o.isObject(a)?o.isArray(a)?a.slice():o.extend({},a):a},o.tap=function(a,b){return b(a),a},o.isMatch=function(a,b){var c=o.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof o&&(a=a._wrapped),b instanceof o&&(b=b._wrapped);var e=h.call(a);if(e!==h.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,i=b.constructor;if(g!==i&&!(o.isFunction(g)&&g instanceof g&&o.isFunction(i)&&i instanceof i)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var j=c.length;j--;)if(c[j]===a)return d[j]===b;if(c.push(a),d.push(b),f){if(j=a.length,j!==b.length)return!1;for(;j--;)if(!G(a[j],b[j],c,d))return!1}else{var l,k=o.keys(a);if(j=k.length,o.keys(b).length!==j)return!1;for(;j--;)if(l=k[j],!o.has(b,l)||!G(a[l],b[l],c,d))return!1}return c.pop(),d.pop(),!0};o.isEqual=function(a,b){return G(a,b)},o.isEmpty=function(a){return null==a?!0:w(a)&&(o.isArray(a)||o.isString(a)||o.isArguments(a))?0===a.length:0===o.keys(a).length},o.isElement=function(a){return!(!a||1!==a.nodeType)},o.isArray=j||function(a){return"[object Array]"===h.call(a)},o.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},o.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){o["is"+a]=function(b){return h.call(b)==="[object "+a+"]"}}),o.isArguments(arguments)||(o.isArguments=function(a){return o.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(o.isFunction=function(a){return"function"==typeof a||!1}),o.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},o.isNaN=function(a){return o.isNumber(a)&&a!==+a},o.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===h.call(a)},o.isNull=function(a){return null===a},o.isUndefined=function(a){return void 0===a},o.has=function(a,b){return null!=a&&i.call(a,b)},o.noConflict=function(){return a._=b,this},o.identity=function(a){return a},o.constant=function(a){return function(){return a}},o.noop=function(){},o.property=t,o.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},o.matcher=o.matches=function(a){return a=o.extendOwn({},a),function(b){return o.isMatch(b,a)}},o.times=function(a,b,c){var d=Array(Math.max(0,a));b=p(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},o.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},o.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=o.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+o.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};o.escape=J(H),o.unescape=J(I),o.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),o.isFunction(d)?d.call(a):d};var K=0;o.uniqueId=function(a){var b=++K+"";return a?a+b:b},o.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};o.template=function(a,b,c){!b&&c&&(b=c),b=o.defaults({},b,o.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,o)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},o.chain=function(a){var b=o(a);return b._chain=!0,b};var P=function(a,b){return a._chain?o(b).chain():b};o.mixin=function(a){o.each(o.functions(a),function(b){var c=o[b]=a[b];o.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),P(this,c.apply(o,a))}})},o.mixin(o),o.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=c[a];o.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),o.each(["concat","join","slice"],function(a){var b=c[a];o.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),o.prototype.value=function(){return this._wrapped},o.prototype.valueOf=o.prototype.toJSON=o.prototype.value,o.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return o})}).call(this),function(){var a=this,b=a.Backbone||{};a.Backbone=b;var c=[],d=c.slice,f=function(a,b,c){var d,e=-1,f=b.length;switch(c.length){case 0:for(;++e<f;)(d=b[e]).callback.call(d.ctx);return;case 1:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0]);return;case 2:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0],c[1]);return;case 3:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0],c[1],c[2]);return;default:for(;++e<f;)(d=b[e]).callback.apply(d.ctx,c)}},g=b.Events={on:function(a,b,c){this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){var d=this,e=_.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c),this},off:function(a,b,c){var d,e,f,g,h,i,j,k;if(!this._events)return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:_.keys(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],d=this._events[a]){if(f=[],b||c)for(j=0,k=d.length;k>j;j++)e=d[j],(b&&b!==(e.callback._callback||e.callback)||c&&c!==e.context)&&f.push(e);this._events[a]=f}return this},trigger:function(a){if(!this._events)return this;var b=d.call(arguments,1),c=this._events[a],e=this._events.all;return c&&f(this,c,b),e&&f(this,e,arguments),this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=_.uniqueId("l"));return d[e]=a,a.on(b,c||this,this),this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,c,this),b||c||delete d[a._listenerId];else{for(var e in d)d[e].off(null,null,this);this._listeners={}}return this}}};g.bind=g.on,g.unbind=g.off,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Backbone=b):a.Backbone=b,"function"==typeof define&&define.amd&&define("backbone",[],function(){return b})}(),function(){function e(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-b)),g=a.setTimeout(function(){c(e+f)},f);return b=e+f,g}for(var a=this,b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=e),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a.requestAnimationFrame),exports.requestAnimationFrame=a.requestAnimationFrame):a.requestAnimationFrame=a.requestAnimationFrame,"function"==typeof define&&define.amd&&define("requestAnimationFrame",[],function(){return a.requestAnimationFrame})}(),function(a,b,c,d){function J(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,c=this.height=a.height;this.renderer.setSize(b,c,this.ratio),this.trigger(t.Events.resize,b,c)}function K(){return(e.performance&&e.performance.now?e.performance:Date).now()}var e=this,f=Math.sin,g=Math.cos,h=Math.atan2,i=Math.sqrt,l=(Math.round,Math.abs,Math.PI),m=2*l,n=l/2,o=Math.pow,p=Math.min,q=Math.max,r=0,s={temp:document.createElement("div"),hasEventListeners:b.isFunction(e.addEventListener),bind:function(a,b,c,d){return this.hasEventListeners?a.addEventListener(b,c,!!d):a.attachEvent("on"+b,c),this},unbind:function(a,b,c,d){return this.hasEventListeners?a.removeEventListeners(b,c,!!d):a.detachEvent("on"+b,c),this}},t=e.Two=function(a){var c=b.defaults(a||{},{fullscreen:!1,width:640,height:480,type:t.Types.svg,autostart:!1});if(b.each(c,function(a,b){"fullscreen"!==b&&"width"!==b&&"height"!==b&&"autostart"!==b&&(this[b]=a)},this),b.isElement(c.domElement)){var d=c.domElement.tagName.toLowerCase();/^(CanvasRenderer-canvas|WebGLRenderer-canvas|SVGRenderer-svg)$/.test(this.type+"-"+d)||(this.type=t.Types[d])}if(this.renderer=new t[this.type](this),t.Utils.setPlaying.call(this,c.autostart),this.frameCount=0,c.fullscreen){var f=b.bind(J,this);b.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),b.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),s.bind(e,"resize",f),f()}else b.isElement(c.domElement)||(this.renderer.setSize(c.width,c.height,this.ratio),this.width=c.width,this.height=c.height);this.scene=this.renderer.scene,t.Instances.push(this)};b.extend(t,{Array:e.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.6.0",Identifier:"two_",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert",order:"order"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return e.Two=a,this},uniqueId:function(){var a=r;return r++,a},Utils:{defineProperty:function(a){var b=this,c="_"+a,d="_flag"+a.charAt(0).toUpperCase()+a.slice(1);Object.defineProperty(b,a,{get:function(){return this[c]},set:function(a){this[c]=a,this[d]=!0}})},release:function(a){b.isObject(a)&&(b.isFunction(a.unbind)&&a.unbind(),a.vertices&&(b.isFunction(a.vertices.unbind)&&a.vertices.unbind(),b.each(a.vertices,function(a){b.isFunction(a.unbind)&&a.unbind()})),a.children&&b.each(a.children,function(a){t.Utils.release(a)}))},xhr:function(a,b){var c=new XMLHttpRequest;return c.open("GET",a),c.onreadystatechange=function(){4===c.readyState&&200===c.status&&b(c.responseText)},c.send(),c},Curve:{CollinearityEpsilon:o(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:e.devicePixelRatio||1,getBackingStoreRatio:function(a){return a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1},getRatio:function(a){return t.Utils.devicePixelRatio/E(a)},setPlaying:function(a){return this.playing=!!a,this},getComputedMatrix:function(a,c){c=c&&c.identity()||new t.Matrix;for(var d=a,e=[];d&&d._matrix;)e.push(d._matrix),d=d.parent;return e.reverse(),b.each(e,function(a){var b=a.elements;c.multiply(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9])}),c},deltaTransformPoint:function(a,b,c){var d=b*a.a+c*a.c+0,e=b*a.b+c*a.d+0;return new t.Vector(d,e)},decomposeMatrix:function(a){var b=t.Utils.deltaTransformPoint(a,0,1),c=t.Utils.deltaTransformPoint(a,1,0),d=180/Math.PI*Math.atan2(b.y,b.x)-90,e=180/Math.PI*Math.atan2(c.y,c.x);return{translateX:a.e,translateY:a.f,scaleX:Math.sqrt(a.a*a.a+a.b*a.b),scaleY:Math.sqrt(a.c*a.c+a.d*a.d),skewX:d,skewY:e,rotation:d}},applySvgAttributes:function(a,c){var f,g,h,i,d={},e={};if(getComputedStyle){var j=getComputedStyle(a);for(f=j.length;f--;)g=j[f],h=j[g],void 0!==h&&(e[g]=h)}for(f=a.attributes.length;f--;)i=a.attributes[f],d[i.nodeName]=i.value;b.isUndefined(e.opacity)||(e["stroke-opacity"]=e.opacity,e["fill-opacity"]=e.opacity),b.extend(e,d),e.visible=!(b.isUndefined(e.display)&&"none"===e.display)||b.isUndefined(e.visibility)&&"hidden"===e.visibility;for(g in e)switch(h=e[g],g){case"transform":if("none"===h)break;var k=a.getCTM();if(null===k)break;var l=t.Utils.decomposeMatrix(a.getCTM());c.translation.set(l.translateX,l.translateY),c.rotation=l.rotation,c.scale=l.scaleX,e.x&&(c.translation.x=e.x),e.y&&(c.translation.y=e.y);break;case"visible":c.visible=h;break;case"stroke-linecap":c.cap=h;break;case"stroke-linejoin":c.join=h;break;case"stroke-miterlimit":c.miter=h;break;case"stroke-width":c.linewidth=parseFloat(h);break;case"stroke-opacity":case"fill-opacity":case"opacity":c.opacity=parseFloat(h);break;case"fill":case"stroke":/url\(\#.*\)/i.test(h)?c[g]=this.getById(h.replace(/url\(\#(.*)\)/i,"$1")):c[g]="none"===h?"transparent":h;break;case"id":c.id=h;break;case"class":c.classList=h.split(" ")}return c},read:{svg:function(){return t.Utils.read.g.apply(this,arguments)},g:function(a){var b=new t.Group;t.Utils.applySvgAttributes.call(this,a,b);for(var c=0,d=a.childNodes.length;d>c;c++){var e=a.childNodes[c],f=e.nodeName;if(!f)return;var g=f.replace(/svg\:/gi,"").toLowerCase();if(g in t.Utils.read){var h=t.Utils.read[g].call(b,e);b.add(h)}}return b},polygon:function(a,b){var c=a.getAttribute("points"),d=[];c.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(a,b,c){d.push(new t.Anchor(parseFloat(b),parseFloat(c)))});var e=new t.Path(d,!b).noStroke();return e.fill="black",t.Utils.applySvgAttributes.call(this,a,e)},polyline:function(a){return t.Utils.read.polygon.call(this,a,!0)},path:function(a){var e,f,c=a.getAttribute("d"),d=new t.Anchor,g=!1,h=!1,i=c.match(/[a-df-z][^a-df-z]*/gi),j=i.length-1;b.each(i.slice(0),function(a,b){var j,c=a[0],d=c.toLowerCase(),e=a.slice(1).trim().split(/[\s,]+|(?=\s?[+\-])/),h=[];switch(0>=b&&(i=[]),d){case"h":case"v":e.length>1&&(j=1);break;case"m":case"l":case"t":e.length>2&&(j=2);break;case"s":case"q":e.length>4&&(j=4);break;case"c":e.length>6&&(j=6);break;case"a":}if(j){for(var k=0,l=e.length,m=0;l>k;k+=j){var n=c;if(m>0)switch(c){case"m":n="l";break;case"M":n="L"}h.push([n].concat(e.slice(k,k+j)).join(" ")),m++}i=Array.prototype.concat.apply(i,h)}else i.push(a)});var k=b.flatten(b.map(i,function(a,c){var i,k,l,m=a[0],n=m.toLowerCase();f=a.slice(1).trim(),f=f.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(a,b,c){return parseFloat(b)*o(10,c)}),f=f.split(/[\s,]+|(?=\s?[+\-])/),h=m===n;var p,q,r,s,u,v,w,x,y;switch(n){case"z":c>=j?g=!0:(k=d.x,l=d.y,i=new t.Anchor(k,l,void 0,void 0,void 0,void 0,t.Commands.close));break;case"m":case"l":k=parseFloat(f[0]),l=parseFloat(f[1]),i=new t.Anchor(k,l,void 0,void 0,void 0,void 0,"m"===n?t.Commands.move:t.Commands.line),h&&i.addSelf(d),d=i;break;case"h":case"v":var z="h"===n?"x":"y",A="x"===z?"y":"x";i=new t.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,t.Commands.line),i[z]=parseFloat(f[0]),i[A]=d[A],h&&(i[z]+=d[z]),d=i;break;case"c":case"s":p=d.x,q=d.y,e||(e=new t.Vector),"c"===n?(r=parseFloat(f[0]),s=parseFloat(f[1]),u=parseFloat(f[2]),v=parseFloat(f[3]),w=parseFloat(f[4]),x=parseFloat(f[5])):(y=I(d,e,h),r=y.x,s=y.y,u=parseFloat(f[0]),v=parseFloat(f[1]),w=parseFloat(f[2]),x=parseFloat(f[3])),h&&(r+=p,s+=q,u+=p,v+=q,w+=p,x+=q),b.isObject(d.controls)||t.Anchor.AppendCurveProperties(d),d.controls.right.set(r-d.x,s-d.y),i=new t.Anchor(w,x,u-w,v-x,void 0,void 0,t.Commands.curve),d=i,e=i.controls.left;break;case"t":case"q":p=d.x,q=d.y,e||(e=new t.Vector),e.isZero()?(r=p,s=q):(r=e.x,q=e.y),"q"===n?(u=parseFloat(f[0]),v=parseFloat(f[1]),w=parseFloat(f[1]),x=parseFloat(f[2])):(y=I(d,e,h),u=y.x,v=y.y,w=parseFloat(f[0]),x=parseFloat(f[1])),h&&(r+=p,s+=q,u+=p,v+=q,w+=p,x+=q),b.isObject(d.controls)||t.Anchor.AppendCurveProperties(d),d.controls.right.set(r-d.x,s-d.y),i=new t.Anchor(w,x,u-w,v-x,void 0,void 0,t.Commands.curve),d=i,e=i.controls.left;break;case"a":p=d.x,q=d.y;var B=parseFloat(f[0]),C=parseFloat(f[1]),E=parseFloat(f[2])*Math.PI/180,F=parseFloat(f[3]),G=parseFloat(f[4]);w=parseFloat(f[5]),x=parseFloat(f[6]),h&&(w+=p,x+=q);var H=(w-p)/2,J=(x-q)/2,K=H*Math.cos(E)+J*Math.sin(E),L=-H*Math.sin(E)+J*Math.cos(E),M=B*B,N=C*C,O=K*K,P=L*L,Q=O/M+P/N;Q>1&&(B*=Math.sqrt(Q),C*=Math.sqrt(Q));var R=Math.sqrt((M*N-M*P-N*O)/(M*P+N*O));b.isNaN(R)?R=0:F!=G&&R>0&&(R*=-1);var S=R*B*L/C,T=-R*C*K/B,U=S*Math.cos(E)-T*Math.sin(E)+(p+w)/2,V=S*Math.sin(E)+T*Math.cos(E)+(q+x)/2,W=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},X=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(W(a)*W(b))},z=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(X(a,b))},Y=z([1,0],[(K-S)/B,(L-T)/C]),Z=[(K-S)/B,(L-T)/C],$=[(-K-S)/B,(-L-T)/C],_=z(Z,$);X(Z,$)<=-1&&(_=Math.PI),X(Z,$)>=1&&(_=0),F&&(_=D(_,2*Math.PI)),G&&_>0&&(_-=2*Math.PI);var aa=t.Resolution,ba=(new t.Matrix).translate(U,V).rotate(E);i=b.map(b.range(aa),function(a){var b=1-a/(aa-1),c=b*_+Y,d=B*Math.cos(c),e=C*Math.sin(c),f=ba.multiply(d,e,1);return new t.Anchor(f.x,f.y,!1,!1,!1,!1,t.Commands.line)}),i.push(new t.Anchor(w,x,!1,!1,!1,!1,t.Commands.line)),d=i[i.length-1],e=d.controls.left}return i}));if(!(k.length<=1)){k=b.compact(k);var l=new t.Path(k,g,void 0,!0).noStroke();return l.fill="black",t.Utils.applySvgAttributes.call(this,a,l)}},circle:function(a){var c=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),e=parseFloat(a.getAttribute("r")),h=t.Resolution,i=b.map(b.range(h),function(a){var b=a/h,c=b*m,d=e*g(c),i=e*f(c);return new t.Anchor(d,i)}),j=new t.Path(i,!0,!0).noStroke();return j.translation.set(c,d),j.fill="black",t.Utils.applySvgAttributes.call(this,a,j)},ellipse:function(a){var c=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),e=parseFloat(a.getAttribute("rx")),h=parseFloat(a.getAttribute("ry")),i=t.Resolution,j=b.map(b.range(i),function(a){var b=a/i,c=b*m,d=e*g(c),j=h*f(c);return new t.Anchor(d,j)}),k=new t.Path(j,!0,!0).noStroke();return k.translation.set(c,d),k.fill="black",t.Utils.applySvgAttributes.call(this,a,k)},rect:function(a){var b=parseFloat(a.getAttribute("x"))||0,c=parseFloat(a.getAttribute("y"))||0,d=parseFloat(a.getAttribute("width")),e=parseFloat(a.getAttribute("height")),f=d/2,g=e/2,h=[new t.Anchor(f,g),new t.Anchor(-f,g),new t.Anchor(-f,-g),new t.Anchor(f,-g)],i=new t.Path(h,!0).noStroke();return i.translation.set(b+f,c+g),i.fill="black",t.Utils.applySvgAttributes.call(this,a,i);
},line:function(a){var b=parseFloat(a.getAttribute("x1")),c=parseFloat(a.getAttribute("y1")),d=parseFloat(a.getAttribute("x2")),e=parseFloat(a.getAttribute("y2")),f=d-b,g=e-c,h=f/2,i=g/2,j=[new t.Anchor(-h,-i),new t.Anchor(h,i)],k=new t.Path(j).noFill();return k.translation.set(b+h,c+i),t.Utils.applySvgAttributes.call(this,a,k)},lineargradient:function(a){for(var c=parseFloat(a.getAttribute("x1")),d=parseFloat(a.getAttribute("y1")),e=parseFloat(a.getAttribute("x2")),f=parseFloat(a.getAttribute("y2")),g=(e+c)/2,h=(f+d)/2,i=[],j=0;j<a.children.length;j++){var k=a.children[j],l=parseFloat(k.getAttribute("offset")),m=k.getAttribute("stop-color"),n=k.getAttribute("stop-opacity"),o=k.getAttribute("style");if(b.isNull(m)){var p=o.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);m=p&&p.length>1?p[1]:void 0}if(b.isNull(n)){var p=o.match(/stop\-opacity\:\s?([0-1\.\-]*)/);n=p&&p.length>1?parseFloat(p[1]):1}i.push(new t.Gradient.Stop(l,m,n))}var q=new t.LinearGradient(c-g,d-h,e-g,f-h,i);return t.Utils.applySvgAttributes.call(this,a,q)},radialgradient:function(a){var c=parseFloat(a.getAttribute("cx"))||0,d=parseFloat(a.getAttribute("cy"))||0,e=parseFloat(a.getAttribute("r")),f=parseFloat(a.getAttribute("fx")),g=parseFloat(a.getAttribute("fy"));b.isNaN(f)&&(f=c),b.isNaN(g)&&(g=d);for(var h=Math.abs(c+f)/2,i=Math.abs(d+g)/2,j=[],k=0;k<a.children.length;k++){var l=a.children[k],m=parseFloat(l.getAttribute("offset")),n=l.getAttribute("stop-color"),o=l.getAttribute("stop-opacity"),p=l.getAttribute("style");if(b.isNull(n)){var q=p.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);n=q&&q.length>1?q[1]:void 0}if(b.isNull(o)){var q=p.match(/stop\-opacity\:\s?([0-1\.\-]*)/);o=q&&q.length>1?parseFloat(q[1]):1}j.push(new t.Gradient.Stop(m,n,o))}var r=new t.RadialGradient(c-h,d-i,e,j,f-h,g-i);return t.Utils.applySvgAttributes.call(this,a,r)}},subdivide:function(a,c,d,e,f,g,h,i,j){j=j||t.Utils.Curve.RecursionLimit;var k=j+1;return a===h&&c===i?[new t.Anchor(h,i)]:b.map(b.range(0,k),function(b){var j=b/k,l=F(j,a,d,f,h),m=F(j,c,e,g,i);return new t.Anchor(l,m)})},getPointOnCubicBezier:function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e},getCurveLength:function(a,b,c,d,e,f,g,h,j){if(a===c&&b===d&&e===g&&f===h){var k=g-a,l=h-b;return i(k*k+l*l)}var m=9*(c-e)+3*(g-a),n=6*(a+e)-12*c,o=3*(c-a),p=9*(d-f)+3*(h-b),q=6*(b+f)-12*d,r=3*(d-b),s=function(a){var b=(m*a+n)*a+o,c=(p*a+q)*a+r;return i(b*b+c*c)};return H(s,0,1,j||t.Utils.Curve.RecursionLimit)},integrate:function(a,b,c,d){for(var e=t.Utils.Curve.abscissas[d-2],f=t.Utils.Curve.weights[d-2],g=.5*(c-b),h=g+b,i=0,j=d+1>>1,k=1&d?f[i++]*a(h):0;j>i;){var l=g*e[i];k+=f[i++]*(a(h+l)+a(h-l))}return g*k},getCurveFromPoints:function(a,c){for(var d=a.length,e=d-1,f=0;d>f;f++){var g=a[f];b.isObject(g.controls)||t.Anchor.AppendCurveProperties(g);var h=c?D(f-1,d):q(f-1,0),i=c?D(f+1,d):p(f+1,e),j=a[h],k=g,l=a[i];z(j,k,l),k._command=0===f?t.Commands.move:t.Commands.curve,k.controls.left.x=b.isNumber(k.controls.left.x)?k.controls.left.x:k.x,k.controls.left.y=b.isNumber(k.controls.left.y)?k.controls.left.y:k.y,k.controls.right.x=b.isNumber(k.controls.right.x)?k.controls.right.x:k.x,k.controls.right.y=b.isNumber(k.controls.right.y)?k.controls.right.y:k.y}},getControlPoints:function(a,c,d){var e=y(a,c),h=y(d,c),i=u(a,c),j=u(d,c),k=(e+h)/2;return c.u=b.isObject(c.controls.left)?c.controls.left:new t.Vector(0,0),c.v=b.isObject(c.controls.right)?c.controls.right:new t.Vector(0,0),1e-4>i||1e-4>j?(c._relative||(c.controls.left.copy(c),c.controls.right.copy(c)),c):(i*=.33,j*=.33,e>h?k+=n:k-=n,c.controls.left.x=g(k)*i,c.controls.left.y=f(k)*i,k-=l,c.controls.right.x=g(k)*j,c.controls.right.y=f(k)*j,c._relative||(c.controls.left.x+=c.x,c.controls.left.y+=c.y,c.controls.right.x+=c.x,c.controls.right.y+=c.y),c)},getReflection:function(a,b,c){return new t.Vector(2*a.x-(b.x+a.x)-(c?a.x:0),2*a.y-(b.y+a.y)-(c?a.y:0))},getAnchorsFromArcData:function(a,c,d,e,f,g,h){var j=((new t.Matrix).translate(a.x,a.y).rotate(c),t.Resolution);return b.map(b.range(j),function(a){var b=(a+1)/j;h&&(b=1-b);var c=b*g+f,i=d*Math.cos(c),k=e*Math.sin(c),l=new t.Anchor(i,k);return t.Anchor.AppendCurveProperties(l),l.command=t.Commands.line,l})},ratioBetween:function(a,b){return(a.x*b.x+a.y*b.y)/(a.length()*b.length())},angleBetween:function(a,b){var c,d;return arguments.length>=4?(c=arguments[0]-arguments[2],d=arguments[1]-arguments[3],h(d,c)):(c=a.x-b.x,d=a.y-b.y,h(d,c))},distanceBetweenSquared:function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},distanceBetween:function(a,b){return i(w(a,b))},toFixed:function(a){return Math.floor(1e3*a)/1e3},mod:function(a,b){for(;0>a;)a+=b;return a%b},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(a){this.name="two.js",this.message=a}}}),t.Utils.Error.prototype=new Error,t.Utils.Error.prototype.constructor=t.Utils.Error,t.Utils.Collection.prototype=new Array,t.Utils.Collection.constructor=t.Utils.Collection,b.extend(t.Utils.Collection.prototype,c.Events,{pop:function(){var a=Array.prototype.pop.apply(this,arguments);return this.trigger(t.Events.remove,[a]),a},shift:function(){var a=Array.prototype.shift.apply(this,arguments);return this.trigger(t.Events.remove,[a]),a},push:function(){var a=Array.prototype.push.apply(this,arguments);return this.trigger(t.Events.insert,arguments),a},unshift:function(){var a=Array.prototype.unshift.apply(this,arguments);return this.trigger(t.Events.insert,arguments),a},splice:function(){var b,a=Array.prototype.splice.apply(this,arguments);return this.trigger(t.Events.remove,a),arguments.length>2&&(b=this.slice(arguments[0],arguments.length-2),this.trigger(t.Events.insert,b),this.trigger(t.Events.order)),a},sort:function(){return Array.prototype.sort.apply(this,arguments),this.trigger(t.Events.order),this},reverse:function(){return Array.prototype.reverse.apply(this,arguments),this.trigger(t.Events.order),this}});var u=t.Utils.distanceBetween,w=(t.Utils.getAnchorsFromArcData,t.Utils.distanceBetweenSquared),y=(t.Utils.ratioBetween,t.Utils.angleBetween),z=t.Utils.getControlPoints,D=(t.Utils.getCurveFromPoints,t.Utils.solveSegmentIntersection,t.Utils.decoupleShapes,t.Utils.mod),E=t.Utils.getBackingStoreRatio,F=t.Utils.getPointOnCubicBezier,H=(t.Utils.getCurveLength,t.Utils.integrate),I=t.Utils.getReflection;b.extend(t.prototype,c.Events,{appendTo:function(a){return a.appendChild(this.renderer.domElement),this},play:function(){return t.Utils.setPlaying.call(this,!0),this.trigger(t.Events.play)},pause:function(){return this.playing=!1,this.trigger(t.Events.pause)},update:function(){var a=!!this._lastFrame,b=K();this.frameCount++,a&&(this.timeDelta=parseFloat((b-this._lastFrame).toFixed(3))),this._lastFrame=b;var c=this.width,d=this.height,e=this.renderer;return(c!==e.width||d!==e.height)&&e.setSize(c,d,this.ratio),this.trigger(t.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(t.Events.render,this.frameCount)},add:function(a){var c=a;return c instanceof Array||(c=b.toArray(arguments)),this.scene.add(c),this},remove:function(a){var c=a;return c instanceof Array||(c=b.toArray(arguments)),this.scene.remove(c),this},clear:function(){return this.scene.remove(b.toArray(this.scene.children)),this},makeLine:function(a,b,c,d){var e=new t.Line(a,b,c,d);return this.scene.add(e),e},makeRectangle:function(a,b,c,d){var e=new t.Rectangle(a,b,c,d);return this.scene.add(e),e},makeRoundedRectangle:function(a,b,c,d,e){var f=new t.RoundedRectangle(a,b,c,d,e);return this.scene.add(f),f},makeCircle:function(a,b,c){return this.makeEllipse(a,b,c,c)},makeEllipse:function(a,b,c,d){var e=new t.Ellipse(a,b,c,d);return this.scene.add(e),e},makeStar:function(a,b,c,d,e){var f=new t.Star(a,b,c,d,e);return this.scene.add(f),f},makeCurve:function(a){var c=arguments.length,d=a;if(!b.isArray(a)){d=[];for(var e=0;c>e;e+=2){var f=arguments[e];if(!b.isNumber(f))break;var g=arguments[e+1];d.push(new t.Anchor(f,g))}}var h=arguments[c-1],i=new t.Path(d,!(b.isBoolean(h)?h:void 0),!0),j=i.getBoundingClientRect();return i.center().translation.set(j.left+j.width/2,j.top+j.height/2),this.scene.add(i),i},makePolygon:function(a,b,c,d){var e=new t.Polygon(a,b,c,d);return this.scene.add(e),e},makeArcSegment:function(a,b,c,d,e,f,g){var h=new t.ArcSegment(a,b,c,d,e,f,g);return this.scene.add(h),h},makePath:function(a){var c=arguments.length,d=a;if(!b.isArray(a)){d=[];for(var e=0;c>e;e+=2){var f=arguments[e];if(!b.isNumber(f))break;var g=arguments[e+1];d.push(new t.Anchor(f,g))}}var h=arguments[c-1],i=new t.Path(d,!(b.isBoolean(h)?h:void 0)),j=i.getBoundingClientRect();return i.center().translation.set(j.left+j.width/2,j.top+j.height/2),this.scene.add(i),i},makeText:function(a,b,c,d){var e=new t.Text(a,b,c,d);return this.add(e),e},makeLinearGradient:function(a,b,c,d){var e=Array.prototype.slice.call(arguments,4),f=new t.LinearGradient(a,b,c,d,e);return this.add(f),f},makeRadialGradient:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=new t.RadialGradient(a,b,c,d);return this.add(e),e},makeGroup:function(a){var c=a;c instanceof Array||(c=b.toArray(arguments));var d=new t.Group;return this.scene.add(d),d.add(c),d},interpret:function(a,b){var c=a.tagName.toLowerCase();if(!(c in t.Utils.read))return null;var d=t.Utils.read[c].call(this,a);return b&&d instanceof t.Group?this.add(d.children):this.add(d),d},load:function(a,c){var e,f,d=[];if(/.*\.svg/gi.test(a))return t.Utils.xhr(a,b.bind(function(a){for(s.temp.innerHTML=a,f=0;f<s.temp.children.length;f++)e=s.temp.children[f],d.push(this.interpret(e));c(d.length<=1?d[0]:d,s.temp.children.length<=1?s.temp.children[0]:s.temp.children)},this)),this;for(s.temp.innerHTML=a,f=0;f<s.temp.children.length;f++)e=s.temp.children[f],d.push(this.interpret(e));return c(d.length<=1?d[0]:d,s.temp.children.length<=1?s.temp.children[0]:s.temp.children),this}}),function(){d(arguments.callee),t.Instances.forEach(function(a){a.playing&&a.update()})}(),"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports&&(module.exports=t)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Vector=function(a,b){this.x=a||0,this.y=b||0};b.extend(e,{zero:new a.Vector}),b.extend(e.prototype,c.Events,{set:function(a,b){return this.x=a,this.y=b,this},copy:function(a){return this.x=a.x,this.y=a.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new e(this.x,this.y)},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this},multiplySelf:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a,b){return b="undefined"==typeof b?1e-4:b,this.distanceTo(a)<b},lerp:function(a,b){var c=(a.x-this.x)*b+this.x,d=(a.y-this.y)*b+this.y;return this.set(c,d)},isZero:function(a){return a="undefined"==typeof a?1e-4:a,this.length()<a},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var f={set:function(b,c){return this._x=b,this._y=c,this.trigger(a.Events.change)},copy:function(b){return this._x=b.x,this._y=b.y,this.trigger(a.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(a.Events.change)},clone:function(){return new e(this._x,this._y)},add:function(b,c){return this._x=b.x+c.x,this._y=b.y+c.y,this.trigger(a.Events.change)},addSelf:function(b){return this._x+=b.x,this._y+=b.y,this.trigger(a.Events.change)},sub:function(b,c){return this._x=b.x-c.x,this._y=b.y-c.y,this.trigger(a.Events.change)},subSelf:function(b){return this._x-=b.x,this._y-=b.y,this.trigger(a.Events.change)},multiplySelf:function(b){return this._x*=b.x,this._y*=b.y,this.trigger(a.Events.change)},multiplyScalar:function(b){return this._x*=b,this._y*=b,this.trigger(a.Events.change)},divideScalar:function(b){return b?(this._x/=b,this._y/=b,this.trigger(a.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this._x*a.x+this._y*a.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this._x-a.x,c=this._y-a.y;return b*b+c*c},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a,b){return b="undefined"==typeof b?1e-4:b,this.distanceTo(a)<b},lerp:function(a,b){var c=(a.x-this._x)*b+this._x,d=(a.y-this._y)*b+this._y;return this.set(c,d)},isZero:function(a){return a="undefined"==typeof a?1e-4:a,this.length()<a},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},g={get:function(){return this._x},set:function(b){this._x=b,this.trigger(a.Events.change,"x")}},h={get:function(){return this._y},set:function(b){this._y=b,this.trigger(a.Events.change,"y")}};a.Vector.prototype.bind=a.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",g),Object.defineProperty(this,"y",h),b.extend(this,f),this._bound=!0),c.Events.bind.apply(this,arguments),this}}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Commands,f=a.Anchor=function(c,d,g,h,i,j,k){return a.Vector.call(this,c,d),this._broadcast=b.bind(function(){this.trigger(a.Events.change)},this),this._command=k||e.move,this._relative=!0,k?(f.AppendCurveProperties(this),b.isNumber(g)&&(this.controls.left.x=g),b.isNumber(h)&&(this.controls.left.y=h),b.isNumber(i)&&(this.controls.right.x=i),void(b.isNumber(j)&&(this.controls.right.y=j))):this};b.extend(f,{AppendCurveProperties:function(b){b.controls={left:new a.Vector(0,0),right:new a.Vector(0,0)}}});var g={listen:function(){return b.isObject(this.controls)||f.AppendCurveProperties(this),this.controls.left.bind(a.Events.change,this._broadcast),this.controls.right.bind(a.Events.change,this._broadcast),this},ignore:function(){return this.controls.left.unbind(a.Events.change,this._broadcast),this.controls.right.unbind(a.Events.change,this._broadcast),this},clone:function(){var b=this.controls,c=new a.Anchor(this.x,this.y,b&&b.left.x,b&&b.left.y,b&&b.right.x,b&&b.right.y,this.command);return c.relative=this._relative,c},toObject:function(){var a={x:this.x,y:this.y};return this._command&&(a.command=this._command),this._relative&&(a.relative=this._relative),this.controls&&(a.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),a}};Object.defineProperty(f.prototype,"command",{get:function(){return this._command},set:function(c){return this._command=c,this._command!==e.curve||b.isObject(this.controls)||f.AppendCurveProperties(this),this.trigger(a.Events.change)}}),Object.defineProperty(f.prototype,"relative",{get:function(){return this._relative},set:function(b){return this._relative==b?this:(this._relative=!!b,this.trigger(a.Events.change))}}),b.extend(f.prototype,a.Vector.prototype,g),a.Anchor.prototype.bind=a.Anchor.prototype.on=function(){a.Vector.prototype.bind.apply(this,arguments),b.extend(this,g)},a.Anchor.prototype.unbind=a.Anchor.prototype.off=function(){a.Vector.prototype.unbind.apply(this,arguments),b.extend(this,g)}}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=Math.cos,f=Math.sin,g=Math.tan,h=a.Matrix=function(c,d,e,f,g,h){this.elements=new a.Array(9);var i=c;b.isArray(i)||(i=b.toArray(arguments)),this.identity().set(i)};b.extend(h,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(b,c,d){if(c.length<=3){var e,f,g,h=b,i=c[0]||0,j=c[1]||0,k=c[2]||0;return e=h[0]*i+h[1]*j+h[2]*k,f=h[3]*i+h[4]*j+h[5]*k,g=h[6]*i+h[7]*j+h[8]*k,{x:e,y:f,z:g}}var l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8],u=c[0],v=c[1],w=c[2],x=c[3],y=c[4],z=c[5],A=c[6],B=c[7],C=c[8];return d=d||new a.Array(9),d[0]=l*u+m*x+n*A,d[1]=l*v+m*y+n*B,d[2]=l*w+m*z+n*C,d[3]=o*u+p*x+q*A,d[4]=o*v+p*y+q*B,d[5]=o*w+p*z+q*C,d[6]=r*u+s*x+t*A,d[7]=r*v+s*y+t*B,d[8]=r*w+s*z+t*C,d}}),b.extend(h.prototype,c.Events,{set:function(c){var d=c;return b.isArray(d)||(d=b.toArray(arguments)),b.extend(this.elements,d),this.trigger(a.Events.change)},identity:function(){return this.set(h.Identity),this},multiply:function(c,d,e,f,g,h,i,j,k){var l=arguments,m=l.length;if(1>=m)return b.each(this.elements,function(a,b){this.elements[b]=a*c},this),this.trigger(a.Events.change);if(3>=m){var n,o,p;return c=c||0,d=d||0,e=e||0,g=this.elements,n=g[0]*c+g[1]*d+g[2]*e,o=g[3]*c+g[4]*d+g[5]*e,p=g[6]*c+g[7]*d+g[8]*e,{x:n,y:o,z:p}}var q=this.elements,r=l,s=q[0],t=q[1],u=q[2],v=q[3],w=q[4],x=q[5],y=q[6],z=q[7],A=q[8],B=r[0],C=r[1],D=r[2],E=r[3],F=r[4],G=r[5],H=r[6],I=r[7],J=r[8];return this.elements[0]=s*B+t*E+u*H,this.elements[1]=s*C+t*F+u*I,this.elements[2]=s*D+t*G+u*J,this.elements[3]=v*B+w*E+x*H,this.elements[4]=v*C+w*F+x*I,this.elements[5]=v*D+w*G+x*J,this.elements[6]=y*B+z*E+A*H,this.elements[7]=y*C+z*F+A*I,this.elements[8]=y*D+z*G+A*J,this.trigger(a.Events.change)},inverse:function(b){var c=this.elements;b=b||new a.Matrix;var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=l*h-i*k,n=-l*g+i*j,o=k*g-h*j,p=d*m+e*n+f*o;return p?(p=1/p,b.elements[0]=m*p,b.elements[1]=(-l*e+f*k)*p,b.elements[2]=(i*e-f*h)*p,b.elements[3]=n*p,b.elements[4]=(l*d-f*j)*p,b.elements[5]=(-i*d+f*g)*p,b.elements[6]=o*p,b.elements[7]=(-k*d+e*j)*p,b.elements[8]=(h*d-e*g)*p,b):null},scale:function(a,b){var c=arguments.length;return 1>=c&&(b=a),this.multiply(a,0,0,0,b,0,0,0,1)},rotate:function(a){var b=e(a),c=f(a);return this.multiply(b,-c,0,c,b,0,0,0,1)},translate:function(a,b){return this.multiply(1,0,a,0,1,b,0,0,1)},skewX:function(a){var b=g(a);return this.multiply(1,b,0,0,1,0,0,0,1)},skewY:function(a){var b=g(a);return this.multiply(1,0,0,b,1,0,0,0,1)},toString:function(a){var b=[];return this.toArray(a,b),b.join(" ")},toArray:function(a,b){var c=this.elements,d=!!b,e=parseFloat(c[0].toFixed(3)),f=parseFloat(c[1].toFixed(3)),g=parseFloat(c[2].toFixed(3)),h=parseFloat(c[3].toFixed(3)),i=parseFloat(c[4].toFixed(3)),j=parseFloat(c[5].toFixed(3));if(a){var k=parseFloat(c[6].toFixed(3)),l=parseFloat(c[7].toFixed(3)),m=parseFloat(c[8].toFixed(3));return d?(b[0]=e,b[1]=h,b[2]=k,b[3]=f,b[4]=i,b[5]=l,b[6]=g,b[7]=j,void(b[8]=m)):[e,h,k,f,i,l,g,j,m]}return d?(b[0]=e,b[1]=h,b[2]=f,b[3]=i,b[4]=g,void(b[5]=j)):[e,h,f,i,g,j]},clone:function(){var b,c,d,e,f,g,h,i,j;return b=this.elements[0],c=this.elements[1],d=this.elements[2],e=this.elements[3],f=this.elements[4],g=this.elements[5],h=this.elements[6],i=this.elements[7],j=this.elements[8],new a.Matrix(b,c,d,e,f,g,h,i,j)}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Utils.mod,f=a.Utils.toFixed,g={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",alignments:{left:"start",center:"middle",right:"end"},createElement:function(a,c){var d=a,e=document.createElementNS(this.ns,d);return"svg"===d&&(c=b.defaults(c||{},{version:this.version})),b.isEmpty(c)||g.setAttributes(e,c),e},setAttributes:function(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++)a.setAttribute(c[d],b[c[d]]);return this},removeAttributes:function(a,b){for(var c in b)a.removeAttribute(c);return this},toString:function(b,c){for(var h,d=b.length,g=d-1,i="",j=0;d>j;j++){var l,q,r,s,t,u,v,w,x,k=b[j],m=c?e(j-1,d):Math.max(j-1,0),n=c?e(j+1,d):Math.min(j+1,g),o=b[m],p=b[n],y=f(k._x),z=f(k._y);switch(k._command){case a.Commands.close:l=a.Commands.close;break;case a.Commands.curve:u=o.controls&&o.controls.right||o,v=k.controls&&k.controls.left||k,o._relative?(q=f(u.x+o.x),r=f(u.y+o.y)):(q=f(u.x),r=f(u.y)),k._relative?(s=f(v.x+k.x),t=f(v.y+k.y)):(s=f(v.x),t=f(v.y)),l=(0===j?a.Commands.move:a.Commands.curve)+" "+q+" "+r+" "+s+" "+t+" "+y+" "+z;break;case a.Commands.move:h=k,l=a.Commands.move+" "+y+" "+z;break;default:l=k._command+" "+y+" "+z}j>=g&&c&&(k._command===a.Commands.curve&&(p=h,w=k.controls&&k.controls.right||k,x=p.controls&&p.controls.left||p,k._relative?(q=f(w.x+k.x),r=f(w.y+k.y)):(q=f(w.x),r=f(w.y)),p._relative?(s=f(x.x+p.x),t=f(x.y+p.y)):(s=f(x.x),t=f(x.y)),y=f(p.x),z=f(p.y),l+=" C "+q+" "+r+" "+s+" "+t+" "+y+" "+z),l+=" Z"),i+=l+" "}return i},getClip:function(a){var b=a._renderer.clip;if(!b){for(var c=a;c.parent;)c=c.parent;b=a._renderer.clip=g.createElement("clipPath"),c.defs.appendChild(b)}return b},group:{appendChild:function(a){var b=a._renderer.elem;if(b){var c=b.nodeName;!c||/(radial|linear)gradient/i.test(c)||a._clip||this.elem.appendChild(b)}},removeChild:function(a){var b=a._renderer.elem;if(b&&b.parentNode==this.elem){var c=b.nodeName;c&&(a._clip||this.elem.removeChild(b))}},orderChild:function(a){this.elem.appendChild(a._renderer.elem)},renderChild:function(a){g[a._renderer.type].render.call(a,this)},render:function(a){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;this._renderer.elem||(this._renderer.elem=g.createElement("g",{id:this.id}),a.appendChild(this._renderer.elem));var b=this._matrix.manual||this._flagMatrix,c={domElement:a,elem:this._renderer.elem};b&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var d=0;d<this.children.length;d++){var e=this.children[d];g[e._renderer.type].render.call(e,a)}return this._flagOpacity&&this._renderer.elem.setAttribute("opacity",this._opacity),this._flagAdditions&&this.additions.forEach(g.group.appendChild,c),this._flagSubtractions&&this.subtractions.forEach(g.group.removeChild,c),this._flagOrder&&this.children.forEach(g.group.orderChild,c),this._flagMask&&(this._mask?this._renderer.elem.setAttribute("clip-path","url(#"+this._mask.id+")"):this._renderer.elem.removeAttribute("clip-path")),this.flagReset()}},path:{render:function(a){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;var b={},c=this._matrix.manual||this._flagMatrix;if(c&&(b.transform="matrix("+this._matrix.toString()+")"),this._flagVertices){var d=g.toString(this._vertices,this._closed);b.d=d}if(this._flagFill&&(this._fill&&this._fill._renderer&&g[this._fill._renderer.type].render.call(this._fill,a),b.fill=this._fill&&this._fill.id?"url(#"+this._fill.id+")":this._fill),this._flagStroke&&(this._stroke&&this._stroke._renderer&&g[this._stroke._renderer.type].render.call(this._stroke,a),b.stroke=this._stroke&&this._stroke.id?"url(#"+this._stroke.id+")":this._stroke),this._flagLinewidth&&(b["stroke-width"]=this._linewidth),this._flagOpacity&&(b["stroke-opacity"]=this._opacity,b["fill-opacity"]=this._opacity),this._flagVisible&&(b.visibility=this._visible?"visible":"hidden"),this._flagCap&&(b["stroke-linecap"]=this._cap),this._flagJoin&&(b["stroke-linejoin"]=this._join),this._flagMiter&&(b["stroke-miterlimit"]=this._miter),this._renderer.elem?g.setAttributes(this._renderer.elem,b):(b.id=this.id,this._renderer.elem=g.createElement("path",b),a.appendChild(this._renderer.elem)),this._flagClip){var e=g.getClip(this),f=this._renderer.elem;this._clip?(f.removeAttribute("id"),e.setAttribute("id",this.id),e.appendChild(f)):(e.removeAttribute("id"),f.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(f))}return this.flagReset()}},text:{render:function(a){this._update();var b={},c=this._matrix.manual||this._flagMatrix;if(c&&(b.transform="matrix("+this._matrix.toString()+")"),this._flagFamily&&(b["font-family"]=this._family),this._flagSize&&(b["font-size"]=this._size),this._flagLeading&&(b["line-height"]=this._leading),this._flagAlignment&&(b["text-anchor"]=g.alignments[this._alignment]||this._alignment),this._flagBaseline&&(b["alignment-baseline"]=b["dominant-baseline"]=this._baseline),this._flagStyle&&(b["font-style"]=this._style),this._flagWeight&&(b["font-weight"]=this._weight),this._flagDecoration&&(b["text-decoration"]=this._decoration),this._flagFill&&(b.fill=this._fill&&this._fill.id?"url(#"+this._fill.id+")":this._fill),this._flagStroke&&(b.stroke=this._stroke&&this._stroke.id?"url(#"+this._stroke.id+")":this._stroke),this._flagLinewidth&&(b["stroke-width"]=this._linewidth),this._flagOpacity&&(b.opacity=this._opacity),this._flagVisible&&(b.visibility=this._visible?"visible":"hidden"),this._renderer.elem?g.setAttributes(this._renderer.elem,b):(b.id=this.id,this._renderer.elem=g.createElement("text",b),a.defs.appendChild(this._renderer.elem)),this._flagClip){var d=g.getClip(this),e=this._renderer.elem;this._clip?(e.removeAttribute("id"),d.setAttribute("id",this.id),d.appendChild(e)):(d.removeAttribute("id"),e.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(e))}return this._flagValue&&(this._renderer.elem.textContent=this._value),this.flagReset()}},"linear-gradient":{render:function(a){this._update();var b={};if(this._flagEndPoints&&(b.x1=this.left._x,b.y1=this.left._y,b.x2=this.right._x,b.y2=this.right._y),this._flagSpread&&(b.spreadMethod=this._spread),this._renderer.elem?g.setAttributes(this._renderer.elem,b):(b.id=this.id,b.gradientUnits="userSpaceOnUse",this._renderer.elem=g.createElement("linearGradient",b),a.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var c=0;c<this.stops.length;c++){var d=this.stops[c],e={};d._flagOffset&&(e.offset=100*d._offset+"%"),d._flagColor&&(e["stop-color"]=d._color),d._flagOpacity&&(e["stop-opacity"]=d._opacity),d._renderer.elem?g.setAttributes(d._renderer.elem,e):d._renderer.elem=g.createElement("stop",e),this._renderer.elem.appendChild(d._renderer.elem),d.flagReset()}}return this.flagReset()}},"radial-gradient":{render:function(a){this._update();var b={};if(this._flagCenter&&(b.cx=this.center._x,b.cy=this.center._y),this._flagFocal&&(b.fx=this.focal._x,b.fy=this.focal._y),this._flagRadius&&(b.r=this._radius),this._flagSpread&&(b.spreadMethod=this._spread),this._renderer.elem?g.setAttributes(this._renderer.elem,b):(b.id=this.id,b.gradientUnits="userSpaceOnUse",this._renderer.elem=g.createElement("radialGradient",b),a.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var c=0;c<this.stops.length;c++){var d=this.stops[c],e={};d._flagOffset&&(e.offset=100*d._offset+"%"),d._flagColor&&(e["stop-color"]=d._color),d._flagOpacity&&(e["stop-opacity"]=d._opacity),d._renderer.elem?g.setAttributes(d._renderer.elem,e):d._renderer.elem=g.createElement("stop",e),this._renderer.elem.appendChild(d._renderer.elem),d.flagReset()}}return this.flagReset()}}},h=a[a.Types.svg]=function(b){this.domElement=b.domElement||g.createElement("svg"),this.scene=new a.Group,this.scene.parent=this,this.defs=g.createElement("defs"),this.domElement.appendChild(this.defs),this.domElement.defs=this.defs,this.domElement.style.overflow="hidden"};b.extend(h,{Utils:g}),b.extend(h.prototype,c.Events,{setSize:function(a,b){return this.width=a,this.height=b,g.setAttributes(this.domElement,{width:a,height:b}),this},render:function(){return g.group.render.call(this.scene,this.domElement),this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Utils.mod,f=a.Utils.toFixed,g=a.Utils.getRatio,h=function(a){return 1==a[0]&&0==a[3]&&0==a[1]&&1==a[4]&&0==a[2]&&0==a[5]},i={isHidden:/(none|transparent)/i,alignments:{left:"start",middle:"center",right:"end"},group:{renderChild:function(a){i[a._renderer.type].render.call(a,this.ctx,!0,this.clip)},render:function(a){this._update();var b=this._matrix.elements,c=this.parent;this._renderer.opacity=this._opacity*(c&&c._renderer?c._renderer.opacity:1);var d=h(b),e=this._mask;this._renderer.context||(this._renderer.context={}),this._renderer.context.ctx=a,d||(a.save(),a.transform(b[0],b[3],b[1],b[4],b[2],b[5])),e&&i[e._renderer.type].render.call(e,a,!0);for(var f=0;f<this.children.length;f++){var g=this.children[f];i[g._renderer.type].render.call(g,a)}return d||a.restore(),this.flagReset()}},path:{render:function(c,d,g){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,N,O;if(this._update(),j=this._matrix.elements,k=this._stroke,l=this._linewidth,m=this._fill,n=this._opacity*this.parent._renderer.opacity,o=this._visible,p=this._cap,q=this._join,r=this._miter,s=this._closed,t=this._vertices,u=t.length,v=u-1,O=h(j),N=this._clip,!d&&(!o||N))return this;O||(c.save(),c.transform(j[0],j[3],j[1],j[4],j[2],j[5])),m&&(b.isString(m)?c.fillStyle=m:(i[m._renderer.type].render.call(m,c),c.fillStyle=m._renderer.gradient)),k&&(b.isString(k)?c.strokeStyle=k:(i[k._renderer.type].render.call(k,c),c.strokeStyle=k._renderer.gradient)),l&&(c.lineWidth=l),r&&(c.miterLimit=r),q&&(c.lineJoin=q),p&&(c.lineCap=p),b.isNumber(n)&&(c.globalAlpha=n),c.beginPath();for(var P=0;P<t.length;P++)switch(z=t[P],K=f(z._x),L=f(z._y),z._command){case a.Commands.close:c.closePath();break;case a.Commands.curve:x=s?e(P-1,u):Math.max(P-1,0),w=s?e(P+1,u):Math.min(P+1,v),y=t[x],A=t[w],G=y.controls&&y.controls.right||y,H=z.controls&&z.controls.left||z,y._relative?(E=G.x+f(y._x),F=G.y+f(y._y)):(E=f(G.x),F=f(G.y)),z._relative?(C=H.x+f(z._x),D=H.y+f(z._y)):(C=f(H.x),D=f(H.y)),c.bezierCurveTo(E,F,C,D,K,L),P>=v&&s&&(A=B,I=z.controls&&z.controls.right||z,J=A.controls&&A.controls.left||A,z._relative?(E=I.x+f(z._x),F=I.y+f(z._y)):(E=f(I.x),F=f(I.y)),A._relative?(C=J.x+f(A._x),D=J.y+f(A._y)):(C=f(J.x),D=f(J.y)),K=f(A._x),L=f(A._y),c.bezierCurveTo(E,F,C,D,K,L));break;case a.Commands.line:c.lineTo(K,L);break;case a.Commands.move:B=z,c.moveTo(K,L)}return s&&c.closePath(),N||g||(i.isHidden.test(m)||c.fill(),i.isHidden.test(k)||c.stroke()),O||c.restore(),N&&!g&&c.clip(),this.flagReset()}},"linear-gradient":{render:function(a){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){this._renderer.gradient=a.createLinearGradient(this.left._x,this.left._y,this.right._x,this.right._y);for(var b=0;b<this.stops.length;b++){var c=this.stops[b];this._renderer.gradient.addColorStop(c._offset,c._color);
}}return this.flagReset()}},text:{render:function(a,c,d){this._update();var e=this._matrix.elements,f=this._stroke,g=this._linewidth,j=this._fill,k=this._opacity*this.parent._renderer.opacity,l=this._visible,m=h(e),n=this._clip;return c||l&&!n?(m||(a.save(),a.transform(e[0],e[3],e[1],e[4],e[2],e[5])),a.font=[this._style,this._weight,this._size+"px/"+this._leading+"px",this._family].join(" "),a.textAlign=i.alignments[this._alignment]||this._alignment,a.textBaseline=this._baseline,j&&(b.isString(j)?a.fillStyle=j:(i[j._renderer.type].render.call(j,a),a.fillStyle=j._renderer.gradient)),f&&(b.isString(f)?a.strokeStyle=f:(i[f._renderer.type].render.call(f,a),a.strokeStyle=f._renderer.gradient)),g&&(a.lineWidth=g),b.isNumber(k)&&(a.globalAlpha=k),n||d||(i.isHidden.test(j)||a.fillText(this.value,0,0),i.isHidden.test(f)||a.strokeText(this.value,0,0)),m||a.restore(),n&&!d&&a.clip(),this.flagReset()):this}},"radial-gradient":{render:function(a){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){this._renderer.gradient=a.createRadialGradient(this.center._x,this.center._y,0,this.focal._x,this.focal._y,this._radius);for(var b=0;b<this.stops.length;b++){var c=this.stops[b];this._renderer.gradient.addColorStop(c._offset,c._color)}}return this.flagReset()}}},j=a[a.Types.canvas]=function(b){var c=b.smoothing!==!1;this.domElement=b.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=b.overdraw||!1,this.ctx.imageSmoothingEnabled=c,this.ctx.mozImageSmoothingEnabled=c,this.ctx.oImageSmoothingEnabled=c,this.ctx.webkitImageSmoothingEnabled=c,this.ctx.imageSmoothingEnabled=c,this.scene=new a.Group,this.scene.parent=this};b.extend(j,{Utils:i}),b.extend(j.prototype,c.Events,{setSize:function(a,c,d){return this.width=a,this.height=c,this.ratio=b.isUndefined(d)?g(this.ctx):d,this.domElement.width=a*this.ratio,this.domElement.height=c*this.ratio,b.extend(this.domElement.style,{width:a+"px",height:c+"px"}),this},render:function(){var a=1===this.ratio;return a||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),i.group.render.call(this.scene,this.ctx),a||this.ctx.restore(),this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,c,d,e){var f=a.Matrix.Multiply,g=a.Utils.mod,h=[1,0,0,0,1,0,0,0,1],i=new a.Array(9),j=a.Utils.getRatio,l=(a.Utils.getComputedMatrix,a.Utils.toFixed),m={isHidden:/(none|transparent)/i,canvas:document.createElement("canvas"),alignments:{left:"start",middle:"center",right:"end"},matrix:new a.Matrix,uv:new a.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{removeChild:function(a,b){if(a.children)for(var c=0;c<a.children.length;c++)m.group.removeChild(a.children[c],b);else b.deleteTexture(a._renderer.texture),delete a._renderer.texture},renderChild:function(a){m[a._renderer.type].render.call(a,this.gl,this.program)},render:function(b,c){this._update();var d=this.parent,e=d._matrix&&d._matrix.manual||d._flagMatrix,g=this._matrix.manual||this._flagMatrix;if((e||g)&&(this._renderer.matrix||(this._renderer.matrix=new a.Array(9)),this._matrix.toArray(!0,i),f(i,d._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*d._renderer.scale,e&&(this._flagMatrix=!0)),this._mask&&(b.enable(b.STENCIL_TEST),b.stencilFunc(b.ALWAYS,1,1),b.colorMask(!1,!1,!1,!0),b.stencilOp(b.KEEP,b.KEEP,b.INCR),m[this._mask._renderer.type].render.call(this._mask,b,c,this),b.colorMask(!0,!0,!0,!0),b.stencilFunc(b.NOTEQUAL,0,1),b.stencilOp(b.KEEP,b.KEEP,b.KEEP)),this._flagOpacity=d._flagOpacity||this._flagOpacity,this._renderer.opacity=this._opacity*(d&&d._renderer?d._renderer.opacity:1),this._flagSubtractions)for(var h=0;h<this.subtractions.length;h++)m.group.removeChild(this.subtractions[h],b);return this.children.forEach(m.group.renderChild,{gl:b,program:c}),this._mask&&(b.colorMask(!1,!1,!1,!1),b.stencilOp(b.KEEP,b.KEEP,b.DECR),m[this._mask._renderer.type].render.call(this._mask,b,c,this),b.colorMask(!0,!0,!0,!0),b.stencilFunc(b.NOTEQUAL,0,1),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.disable(b.STENCIL_TEST)),this.flagReset()}},path:{updateCanvas:function(d){var e,f,h,i,j,k,n,o,p,q,r,s,t,u,v=d._vertices,w=this.canvas,x=this.ctx,y=d._renderer.scale,z=d._stroke,A=d._linewidth,B=d._fill,C=d._renderer.opacity||d._opacity,D=d._cap,E=d._join,F=d._miter,G=d._closed,H=v.length,I=H-1;w.width=Math.max(Math.ceil(d._renderer.rect.width*y),1),w.height=Math.max(Math.ceil(d._renderer.rect.height*y),1);var J=d._renderer.rect.centroid,K=J.x,L=J.y;x.clearRect(0,0,w.width,w.height),B&&(c.isString(B)?x.fillStyle=B:(m[B._renderer.type].render.call(B,x,d),x.fillStyle=B._renderer.gradient)),z&&(c.isString(z)?x.strokeStyle=z:(m[z._renderer.type].render.call(z,x,d),x.strokeStyle=z._renderer.gradient)),A&&(x.lineWidth=A),F&&(x.miterLimit=F),E&&(x.lineJoin=E),D&&(x.lineCap=D),c.isNumber(C)&&(x.globalAlpha=C);var M;x.save(),x.scale(y,y),x.translate(K,L),x.beginPath();for(var N=0;N<v.length;N++)switch(b=v[N],t=l(b._x),u=l(b._y),b._command){case a.Commands.close:x.closePath();break;case a.Commands.curve:f=G?g(N-1,H):Math.max(N-1,0),e=G?g(N+1,H):Math.min(N+1,I),h=v[f],i=v[e],p=h.controls&&h.controls.right||h,q=b.controls&&b.controls.left||b,h._relative?(n=l(p.x+h._x),o=l(p.y+h._y)):(n=l(p.x),o=l(p.y)),b._relative?(j=l(q.x+b._x),k=l(q.y+b._y)):(j=l(q.x),k=l(q.y)),x.bezierCurveTo(n,o,j,k,t,u),N>=I&&G&&(i=M,r=b.controls&&b.controls.right||b,s=i.controls&&i.controls.left||i,b._relative?(n=l(r.x+b._x),o=l(r.y+b._y)):(n=l(r.x),o=l(r.y)),i._relative?(j=l(s.x+i._x),k=l(s.y+i._y)):(j=l(s.x),k=l(s.y)),t=l(i._x),u=l(i._y),x.bezierCurveTo(n,o,j,k,t,u));break;case a.Commands.line:x.lineTo(t,u);break;case a.Commands.move:M=b,x.moveTo(t,u)}G&&x.closePath(),m.isHidden.test(B)||x.fill(),m.isHidden.test(z)||x.stroke(),x.restore()},getBoundingClientRect:function(a,b,d){var i,j,e=1/0,f=-(1/0),g=1/0,h=-(1/0);a.forEach(function(a){var i,j,k,l,m,n,b=a.x,c=a.y,d=a.controls;g=Math.min(c,g),e=Math.min(b,e),f=Math.max(b,f),h=Math.max(c,h),a.controls&&(m=d.left,n=d.right,m&&n&&(i=a._relative?m.x+b:m.x,j=a._relative?m.y+c:m.y,k=a._relative?n.x+b:n.x,l=a._relative?n.y+c:n.y,i&&j&&k&&l&&(g=Math.min(j,l,g),e=Math.min(i,k,e),f=Math.max(i,k,f),h=Math.max(j,l,h))))}),c.isNumber(b)&&(g-=b,e-=b,f+=b,h+=b),i=f-e,j=h-g,d.top=g,d.left=e,d.right=f,d.bottom=h,d.width=i,d.height=j,d.centroid||(d.centroid={}),d.centroid.x=-e,d.centroid.y=-g},render:function(b,c,d){if(!this._visible||!this._opacity)return this;var e=this.parent,g=e._matrix.manual||e._flagMatrix,h=this._matrix.manual||this._flagMatrix,j=this._flagVertices||this._flagFill||this._fill instanceof a.LinearGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagEndPoints)||this._fill instanceof a.RadialGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagRadius||this._fill._flagCenter||this._fill._flagFocal)||this._stroke instanceof a.LinearGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagEndPoints)||this._stroke instanceof a.RadialGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagRadius||this._stroke._flagCenter||this._stroke._flagFocal)||this._flagStroke||this._flagLinewidth||this._flagOpacity||e._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale||!this._renderer.texture;return this._update(),(g||h)&&(this._renderer.matrix||(this._renderer.matrix=new a.Array(9)),this._matrix.toArray(!0,i),f(i,e._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*e._renderer.scale),j&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new a.Array(12)),this._renderer.opacity=this._opacity*e._renderer.opacity,m.path.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),m.getTriangles(this._renderer.rect,this._renderer.triangles),m.updateBuffer.call(m,b,this,c),m.updateTexture.call(m,b,this)),!this._clip||d?(b.bindBuffer(b.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),b.vertexAttribPointer(c.textureCoords,2,b.FLOAT,!1,0,0),b.bindTexture(b.TEXTURE_2D,this._renderer.texture),b.uniformMatrix3fv(c.matrix,!1,this._renderer.matrix),b.bindBuffer(b.ARRAY_BUFFER,this._renderer.buffer),b.vertexAttribPointer(c.position,2,b.FLOAT,!1,0,0),b.drawArrays(b.TRIANGLES,0,6),this.flagReset()):void 0}},text:{updateCanvas:function(a){var b=this.canvas,d=this.ctx,e=a._renderer.scale,f=a._stroke,g=a._linewidth*e,h=a._fill,i=a._renderer.opacity||a._opacity;b.width=Math.max(Math.ceil(a._renderer.rect.width*e),1),b.height=Math.max(Math.ceil(a._renderer.rect.height*e),1);var j=a._renderer.rect.centroid,k=j.x,l=j.y;d.clearRect(0,0,b.width,b.height),d.font=[a._style,a._weight,a._size+"px/"+a._leading+"px",a._family].join(" "),d.textAlign="center",d.textBaseline="middle",h&&(c.isString(h)?d.fillStyle=h:(m[h._renderer.type].render.call(h,d,a),d.fillStyle=h._renderer.gradient)),f&&(c.isString(f)?d.strokeStyle=f:(m[f._renderer.type].render.call(f,d,a),d.strokeStyle=f._renderer.gradient)),g&&(d.lineWidth=g),c.isNumber(i)&&(d.globalAlpha=i),d.save(),d.scale(e,e),d.translate(k,l),m.isHidden.test(h)||d.fillText(a.value,0,0),m.isHidden.test(f)||d.strokeText(a.value,0,0),d.restore()},getBoundingClientRect:function(a,b){var c=m.ctx;c.font=[a._style,a._weight,a._size+"px/"+a._leading+"px",a._family].join(" "),c.textAlign="center",c.textBaseline=a._baseline;var d=c.measureText(a._value).width,e=Math.max(a._size||a._leading);this._linewidth&&!m.isHidden.test(this._stroke)&&(e+=this._linewidth);var f=d/2,g=e/2;switch(m.alignments[a._alignment]||a._alignment){case m.alignments.left:b.left=0,b.right=d;break;case m.alignments.right:b.left=-d,b.right=0;break;default:b.left=-f,b.right=f}switch(a._baseline){case"bottom":b.top=-e,b.bottom=0;break;case"top":b.top=0,b.bottom=e;break;default:b.top=-g,b.bottom=g}b.width=d,b.height=e,b.centroid||(b.centroid={}),b.centroid.x=f,b.centroid.y=g},render:function(b,c,d){if(!this._visible||!this._opacity)return this;var e=this.parent,g=e._matrix.manual||e._flagMatrix,h=this._matrix.manual||this._flagMatrix,j=this._flagVertices||this._flagFill||this._fill instanceof a.LinearGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagEndPoints)||this._fill instanceof a.RadialGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagRadius||this._fill._flagCenter||this._fill._flagFocal)||this._stroke instanceof a.LinearGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagEndPoints)||this._stroke instanceof a.RadialGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagRadius||this._stroke._flagCenter||this._stroke._flagFocal)||this._flagStroke||this._flagLinewidth||this._flagOpacity||e._flagOpacity||this._flagVisible||this._flagScale||this._flagValue||this._flagFamily||this._flagSize||this._flagLeading||this._flagAlignment||this._flagBaseline||this._flagStyle||this._flagWeight||this._flagDecoration||!this._renderer.texture;return this._update(),(g||h)&&(this._renderer.matrix||(this._renderer.matrix=new a.Array(9)),this._matrix.toArray(!0,i),f(i,e._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*e._renderer.scale),j&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new a.Array(12)),this._renderer.opacity=this._opacity*e._renderer.opacity,m.text.getBoundingClientRect(this,this._renderer.rect),m.getTriangles(this._renderer.rect,this._renderer.triangles),m.updateBuffer.call(m,b,this,c),m.updateTexture.call(m,b,this)),!this._clip||d?(b.bindBuffer(b.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),b.vertexAttribPointer(c.textureCoords,2,b.FLOAT,!1,0,0),b.bindTexture(b.TEXTURE_2D,this._renderer.texture),b.uniformMatrix3fv(c.matrix,!1,this._renderer.matrix),b.bindBuffer(b.ARRAY_BUFFER,this._renderer.buffer),b.vertexAttribPointer(c.position,2,b.FLOAT,!1,0,0),b.drawArrays(b.TRIANGLES,0,6),this.flagReset()):void 0}},"linear-gradient":{render:function(a,b){if(a.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){this._renderer.gradient=a.createLinearGradient(this.left._x,this.left._y,this.right._x,this.right._y);for(var c=0;c<this.stops.length;c++){var d=this.stops[c];this._renderer.gradient.addColorStop(d._offset,d._color)}}return this.flagReset()}}},"radial-gradient":{render:function(a,b){if(a.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){this._renderer.gradient=a.createRadialGradient(this.center._x,this.center._y,0,this.focal._x,this.focal._y,this._radius);for(var c=0;c<this.stops.length;c++){var d=this.stops[c];this._renderer.gradient.addColorStop(d._offset,d._color)}}return this.flagReset()}}},getTriangles:function(a,b){var c=a.top,d=a.left,e=a.right,f=a.bottom;b[0]=d,b[1]=c,b[2]=e,b[3]=c,b[4]=d,b[5]=f,b[6]=d,b[7]=f,b[8]=e,b[9]=c,b[10]=e,b[11]=f},updateTexture:function(a,b){this[b._renderer.type].updateCanvas.call(m,b),b._renderer.texture&&a.deleteTexture(b._renderer.texture),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer),b._renderer.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,b._renderer.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),this.canvas.width<=0||this.canvas.height<=0||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,d){c.isObject(b._renderer.buffer)&&a.deleteBuffer(b._renderer.buffer),b._renderer.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.buffer),a.enableVertexAttribArray(d.position),a.bufferData(a.ARRAY_BUFFER,b._renderer.triangles,a.STATIC_DRAW),c.isObject(b._renderer.textureCoordsBuffer)&&a.deleteBuffer(b._renderer.textureCoordsBuffer),b._renderer.textureCoordsBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer),a.enableVertexAttribArray(d.textureCoords),a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(b,d){var e,f,g;if(e=b.createProgram(),c.each(d,function(a){b.attachShader(e,a)}),b.linkProgram(e),f=b.getProgramParameter(e,b.LINK_STATUS),!f)throw g=b.getProgramInfoLog(e),b.deleteProgram(e),new a.Utils.Error("unable to link program: "+g);return e}},shaders:{create:function(b,c,d){var e,f,g;if(e=b.createShader(b[d]),b.shaderSource(e,c),b.compileShader(e),f=b.getShaderParameter(e,b.COMPILE_STATUS),!f)throw g=b.getShaderInfoLog(e),b.deleteShader(e),new a.Utils.Error("unable to compile shader "+e+": "+g);return e},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};m.ctx=m.canvas.getContext("2d");var n=a[a.Types.webgl]=function(b){var d,e,f,g;if(this.domElement=b.domElement||document.createElement("canvas"),this.scene=new a.Group,this.scene.parent=this,this._renderer={matrix:new a.Array(h),scale:1,opacity:1},this._flagMatrix=!0,d=c.defaults(b||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=d.overdraw,e=this.ctx=this.domElement.getContext("webgl",d)||this.domElement.getContext("experimental-webgl",d),!this.ctx)throw new a.Utils.Error("unable to create a webgl context. Try using another renderer.");f=m.shaders.create(e,m.shaders.vertex,m.shaders.types.vertex),g=m.shaders.create(e,m.shaders.fragment,m.shaders.types.fragment),this.program=m.program.create(e,[f,g]),e.useProgram(this.program),this.program.position=e.getAttribLocation(this.program,"a_position"),this.program.matrix=e.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=e.getAttribLocation(this.program,"a_textureCoords"),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)};c.extend(n,{Utils:m}),c.extend(n.prototype,d.Events,{setSize:function(a,b,d){this.width=a,this.height=b,this.ratio=c.isUndefined(d)?j(this.ctx):d,this.domElement.width=a*this.ratio,this.domElement.height=b*this.ratio,c.extend(this.domElement.style,{width:a+"px",height:b+"px"}),a*=this.ratio,b*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,a,b);var e=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(e,a,b),this},render:function(){var a=this.ctx;return this.overdraw||a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),m.group.render.call(this.scene,a,this.program),this._flagMatrix=!1,this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Shape=function(){this._renderer={},this.id=a.Identifier+a.uniqueId(),this.classList=[],this._matrix=new a.Matrix,this.translation=new a.Vector,this.translation.bind(a.Events.change,b.bind(e.FlagMatrix,this)),this.rotation=0,this.scale=1};b.extend(e,c.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(a){Object.defineProperty(a,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a,this._flagMatrix=!0}}),Object.defineProperty(a,"scale",{get:function(){return this._scale},set:function(a){this._scale=a,this._flagMatrix=!0,this._flagScale=!0}})}}),b.extend(e.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(a){return a.add(this),this},clone:function(){var a=new e;return a.translation.copy(this.translation),a.rotation=this.rotation,a.scale=this.scale,b.each(e.Properties,function(b){a[b]=this[b]},this),a._update()},_update:function(a){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),a&&this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=this._flagScale=!1,this}}),e.MakeObservable(e.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){function k(b,c,d){var e,f,g,h,i,j,k,l,m=c.controls&&c.controls.right,n=b.controls&&b.controls.left;return e=c.x,i=c.y,f=(m||c).x,j=(m||c).y,g=(n||b).x,k=(n||b).y,h=b.x,l=b.y,m&&c._relative&&(f+=c.x,j+=c.y),n&&b._relative&&(g+=b.x,k+=b.y),a.Utils.getCurveLength(e,i,f,j,g,k,h,l,d)}function l(b,c,d){var e,f,g,h,i,j,k,l,m=c.controls&&c.controls.right,n=b.controls&&b.controls.left;return e=c.x,i=c.y,f=(m||c).x,j=(m||c).y,g=(n||b).x,k=(n||b).y,h=b.x,l=b.y,m&&c._relative&&(f+=c.x,j+=c.y),n&&b._relative&&(g+=b.x,k+=b.y),a.Utils.subdivide(e,i,f,j,g,k,h,l,d)}var e=Math.min,f=Math.max,g=Math.round,h=a.Utils.getComputedMatrix,i={};b.each(a.Commands,function(a,b){i[b]=new RegExp(a)});var j=a.Path=function(b,c,d,e){a.Shape.call(this),this._renderer.type="path",this._closed=!!c,this._curved=!!d,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=b,this.automatic=!e};b.extend(j,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(c){a.Shape.MakeObservable(c),b.each(j.Properties.slice(0,8),function(a){var b="_"+a,d="_flag"+a.charAt(0).toUpperCase()+a.slice(1);Object.defineProperty(c,a,{get:function(){return this[b]},set:function(a){this[b]=a,this[d]=!0}})}),Object.defineProperty(c,"length",{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(c,"closed",{get:function(){return this._closed},set:function(a){this._closed=!!a,this._flagVertices=!0}}),Object.defineProperty(c,"curved",{get:function(){return this._curved},set:function(a){this._curved=!!a,this._flagVertices=!0}}),Object.defineProperty(c,"automatic",{get:function(){return this._automatic},set:function(a){if(a!==this._automatic){this._automatic=!!a;var c=this._automatic?"ignore":"listen";b.each(this.vertices,function(a){a[c]()})}}}),Object.defineProperty(c,"beginning",{get:function(){return this._beginning},set:function(a){this._beginning=e(f(a,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(c,"ending",{get:function(){return this._ending},set:function(a){this._ending=e(f(a,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(c,"vertices",{get:function(){return this._collection},set:function(c){var d=b.bind(j.FlagVertices,this),e=b.bind(function(b){for(var c=b.length;c--;)b[c].bind(a.Events.change,d);d()},this),f=b.bind(function(c){b.each(c,function(b){b.unbind(a.Events.change,d)},this),d()},this);this._collection&&this._collection.unbind(),this._collection=new a.Utils.Collection((c||[]).slice(0)),this._collection.bind(a.Events.insert,e),this._collection.bind(a.Events.remove,f),e(this._collection)}}),Object.defineProperty(c,"clip",{get:function(){return this._clip},set:function(a){this._clip=a,this._flagClip=!0}})}}),b.extend(j.prototype,a.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_flagClip:!1,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_clip:!1,clone:function(c){c=c||this.parent;var d=b.map(this.vertices,function(a){return a.clone()}),e=new j(d,this.closed,this.curved,!this.automatic);return b.each(a.Path.Properties,function(a){e[a]=this[a]},this),e.translation.copy(this.translation),e.rotation=this.rotation,e.scale=this.scale,c.add(e),e},toObject:function(){var c={vertices:b.map(this.vertices,function(a){return a.toObject()})};return b.each(a.Shape.Properties,function(a){c[a]=this[a]},this),c.translation=this.translation.toObject,c.rotation=this.rotation,c.scale=this.scale,c},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var a=this.getBoundingClientRect(!0);return a.centroid={x:a.left+a.width/2,y:a.top+a.height/2},b.each(this.vertices,function(b){b.addSelf(a.centroid)}),this},center:function(){var a=this.getBoundingClientRect(!0);return a.centroid={x:a.left+a.width/2,y:a.top+a.height/2},b.each(this.vertices,function(b){b.subSelf(a.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(a){var b,c,d,g,i,j,k,l=1/0,m=-(1/0),n=1/0,o=-(1/0);for(this._update(!0),b=a?this._matrix:h(this),c=this.linewidth/2,d=this._vertices.length,j=0;d>j;j++)k=this._vertices[j],g=k.x,i=k.y,k=b.multiply(g,i,1),n=e(k.y-c,n),l=e(k.x-c,l),m=f(k.x+c,m),o=f(k.y+c,o);return{top:n,left:l,right:m,bottom:o,width:m-l,height:o-n}},getPointAt:function(c,d){for(var e,f,g,h,i,j,k,l,m,n,o,p,q=this.length*Math.min(Math.max(c,0),1),r=this.vertices.length,s=r-1,t=null,u=null,v=0,w=this._lengths.length,x=0;w>v;v++){if(x+this._lengths[v]>q){t=this.vertices[this.closed?a.Utils.mod(v,r):v],u=this.vertices[Math.min(Math.max(v-1,0),s)],q-=x,c=q/this._lengths[v];break}x+=this._lengths[v]}return b.isNull(t)||b.isNull(u)?null:(p=u.controls&&u.controls.right,o=t.controls&&t.controls.left,f=u.x,k=u.y,g=(p||u).x,l=(p||u).y,h=(o||t).x,m=(o||t).y,i=t.x,n=t.y,p&&u._relative&&(g+=u.x,l+=u.y),o&&t._relative&&(h+=t.x,m+=t.y),e=a.Utils.getPointOnCubicBezier(c,f,g,h,i),j=a.Utils.getPointOnCubicBezier(c,k,l,m,n),b.isObject(d)?(d.x=e,d.y=j,d):new a.Vector(e,j))},plot:function(){if(this.curved)return a.Utils.getCurveFromPoints(this._vertices,this.closed),this;for(var b=0;b<this._vertices.length;b++)this._vertices[b]._command=0===b?a.Commands.move:a.Commands.line;return this},subdivide:function(c){this._update();var d=this.vertices.length-1,e=this.vertices[d],f=this._closed||this.vertices[d]._command===a.Commands.close,g=[];return b.each(this.vertices,function(h,i){if(0>=i&&!f)return void(e=h);if(h.command===a.Commands.move)return g.push(new a.Anchor(e.x,e.y)),i>0&&(g[g.length-1].command=a.Commands.line),void(e=h);var j=l(h,e,c);g=g.concat(j),b.each(j,function(b,c){0>=c&&e.command===a.Commands.move?b.command=a.Commands.move:b.command=a.Commands.line}),i>=d&&(this._closed&&this._automatic?(e=h,j=l(h,e,c),g=g.concat(j),b.each(j,function(b,c){0>=c&&e.command===a.Commands.move?b.command=a.Commands.move:b.command=a.Commands.line})):f&&g.push(new a.Anchor(h.x,h.y)),g[g.length-1].command=f?a.Commands.close:a.Commands.line),e=h},this),this._automatic=!1,this._curved=!1,this.vertices=g,this},_updateLength:function(c){this._update();var d=this.vertices.length-1,e=this.vertices[d],f=this._closed||this.vertices[d]._command===a.Commands.close,g=0;return b.isUndefined(this._lengths)&&(this._lengths=[]),b.each(this.vertices,function(b,h){return 0>=h&&!f||b.command===a.Commands.move?(e=b,void(this._lengths[h]=0)):(this._lengths[h]=k(b,e,c),g+=this._lengths[h],h>=d&&f&&(e=b,this._lengths[h+1]=k(b,e,c),g+=this._lengths[h+1]),void(e=b))},this),this._length=g,this},_update:function(){if(this._flagVertices){var d,b=this.vertices.length,c=b-1,e=g(this._beginning*c),f=g(this._ending*c);this._vertices.length=0;for(var h=e;f+1>h;h++)d=this.vertices[h],this._vertices.push(d);this._automatic&&this.plot()}return a.Shape.prototype._update.apply(this,arguments),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=this._flagClip=!1,a.Shape.prototype.flagReset.call(this),this}}),j.MakeObservable(j.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=a.Line=function(b,c,d,f){var g=d-b,h=f-c,i=g/2,j=h/2;e.call(this,[new a.Anchor(-i,-j),new a.Anchor(i,j)]),this.translation.set(b+i,c+j)};b.extend(f.prototype,e.prototype),e.MakeObservable(f.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=a.Rectangle=function(b,c,d,f){var g=d/2,h=f/2;e.call(this,[new a.Anchor(-g,-h),new a.Anchor(g,-h),new a.Anchor(g,h),new a.Anchor(-g,h)],!0),this.translation.set(b,c)};b.extend(f.prototype,e.prototype),e.MakeObservable(f.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=2*Math.PI,g=Math.cos,h=Math.sin,i=a.Ellipse=function(c,d,i,j){b.isNumber(j)||(j=i);var k=a.Resolution,l=b.map(b.range(k),function(b){var c=b/k,d=c*f,e=i*g(d),l=j*h(d);return new a.Anchor(e,l)},this);e.call(this,l,!0,!0),this.translation.set(c,d)};b.extend(i.prototype,e.prototype),e.MakeObservable(i.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=2*Math.PI,g=Math.cos,h=Math.sin,i=a.Polygon=function(c,d,i,j){j=Math.max(j||0,3);var k=b.map(b.range(j),function(b){var c=(b+.5)/j,d=f*c+Math.PI/2,e=i*g(d),k=i*h(d);return new a.Anchor(e,k)});e.call(this,k,!0),this.translation.set(c,d)};b.extend(i.prototype,e.prototype),e.MakeObservable(i.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=Math.PI,h=(2*Math.PI,Math.cos),i=Math.sin,k=(Math.abs,a.SineRing=function(b,c,d,g,j,k){var l=2*g+1,m=Math.PI/g,n=f*d/g/2;k=k||1;var q,r,s,t,u,v,o=[],p=f;o.push(new a.Anchor(i(p)*(d+j/2),h(p)*(d+j/2),0,0,0,0,a.Commands.move));for(var w=0;l>w;w++)p=m*w+f,w%2===0?(q=Math.sin(p)*(d+j/2),r=Math.cos(p)*(d+j/2)):(q=Math.sin(p)*(d-j/2),r=Math.cos(p)*(d-j/2)),s=Math.sin(p-Math.PI/2)*n*k,t=Math.cos(p-Math.PI/2)*n*k,u=Math.sin(p+Math.PI/2)*n*k,v=Math.cos(p+Math.PI/2)*n*k,0===w&&(s=t=0),w===l-1&&(u=v=0),o.push(new a.Anchor(q,r,s,t,u,v,a.Commands.curve));e.call(this,o,!0,!1,!0),this.translation.set(b,c)});b.extend(k.prototype,e.prototype),e.MakeObservable(k.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Path,f=2*Math.PI,g=Math.cos,h=Math.sin,i=a.Star=function(c,d,i,j,k){b.isNumber(j)||(j=i/2),(!b.isNumber(k)||0>=k)&&(k=5);var l=2*k,m=b.map(b.range(l),function(b){var c=(b-.5)/l,d=c*f,e=b%2?j:i,k=e*g(d),m=e*h(d);return new a.Anchor(k,m)});e.call(this,m,!0),this.translation.set(c,d)};b.extend(i.prototype,e.prototype),e.MakeObservable(i.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){function g(c,d,e,f,g){var i=0,j=0,k=a.Resolution,n=(c[c.length-1],new a.Anchor(d,e),0>d?-f:f),o=0>e?-f:f;switch(g){case 1:i=-Math.PI/2,j=0;break;case 2:i=-Math.PI,j=-Math.PI/2;break;case 3:i=1.5*-Math.PI,j=-Math.PI;break;case 4:i=0,j=Math.PI/2}var p=b.map(b.range(k),function(b){
var c=h(k-b,0,k,i,j),g=f*Math.cos(c)+d-n,l=f*Math.sin(c)+e-o,m=new a.Anchor(g,l);return m}).reverse();return c.concat(p)}function h(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))}var e=a.Path,f=a.RoundedRectangle=function(c,d,f,h,i){var l,m,j=f/2,k=h/2;b.isNumber(i)||(i=Math.floor(Math.min(f,h)/12));var n=[new a.Anchor(-j+i,-k),new a.Anchor(j-i,-k)];l=j,m=-k,n=g(n,l,m,i,1),n.push(new a.Anchor(j,k-i)),l=j,m=k,n=g(n,l,m,i,4),n.push(new a.Anchor(-j+i,k)),l=-j,m=k,n=g(n,l,m,i,3),n.push(new a.Anchor(-j,-k+i)),l=-j,m=-k,n=g(n,l,m,i,2),n.pop(),e.call(this,n,!0),this.translation.set(c,d)};b.extend(f.prototype,e.prototype),e.MakeObservable(f.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){var e=a.Utils.getComputedMatrix,f=document.createElement("canvas");f.getContext("2d");a.Text=function(c,d,e,f){return a.Shape.call(this),this._renderer.type="text",this.value=c,b.isNumber(d)&&(this.translation.x=d),b.isNumber(e)&&(this.translation.y=e),b.isObject(f)?void b.each(a.Text.Properties,function(a){a in f&&(this[a]=f[a])},this):this},b.extend(a.Text,{Properties:["value","family","size","leading","alignment","fill","stroke","linewidth","style","weight","decoration","baseline","opacity","visible"],MakeObservable:function(c){a.Shape.MakeObservable(c),b.each(a.Text.Properties,function(a){var b="_"+a,d="_flag"+a.charAt(0).toUpperCase()+a.slice(1);Object.defineProperty(c,a,{get:function(){return this[b]},set:function(a){this[b]=a,this[d]=!0}})}),Object.defineProperty(c,"clip",{get:function(){return this._clip},set:function(a){this._clip=a,this._flagClip=!0}})}}),b.extend(a.Text.prototype,a.Shape.prototype,{_flagValue:!0,_flagFamily:!0,_flagSize:!0,_flagLeading:!0,_flagAlignment:!0,_flagBaseline:!0,_flagStyle:!0,_flagWeight:!0,_flagDecoration:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagClip:!1,_value:"",_family:"sans-serif",_size:13,_leading:17,_alignment:"center",_baseline:"middle",_style:"normal",_weight:500,_decoration:"none",_fill:"#000",_stroke:"transparent",_linewidth:1,_opacity:1,_visible:!0,_clip:!1,clone:function(c){var c=c||this.parent,d=new a.Text(this.value);return d.translation.copy(this.translation),d.rotation=this.rotation,d.scale=this.scale,b.each(a.Text.Properties,function(a){d[a]=this[a]},this),c.add(d),d},toObject:function(){var c={translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return b.each(a.Text.Properties,function(a){c[a]=this[a]},this),c},noStroke:function(){return this.stroke="transparent",this},noFill:function(){return this.fill="transparent",this},getBoundingClientRect:function(a){var b,i;return this._update(!0),b=a?this._matrix:e(this),i=b.multiply(0,0,1),{top:i.x,left:i.y,right:i.x,bottom:i.y,width:0,height:0}},flagReset:function(){return this._flagValue=this._flagFamily=this._flagSize=this._flagLeading=this._flagAlignment=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpaicty=this._flagVisible=this._flagClip=this._flagDecoration=this._flagBaseline=!1,a.Shape.prototype.flagReset.call(this),this}}),a.Text.MakeObservable(a.Text.prototype)}(Two,"function"!=typeof require||"function"==typeof define&&define.amd?_:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?requestAnimationFrame:require("requestAnimationFrame")),function(a,b,c,d){function i(a,c){var e,d=a.parent;return d===c?(this.additions.push(a),void(this._flagAdditions=!0)):(d&&d.children.ids[a.id]&&(e=b.indexOf(d.children,a),d.children.splice(e,1),e=b.indexOf(d.additions,a),e>=0?d.additions.splice(e,1):(d.subtractions.push(a),d._flagSubtractions=!0)),c?(a.parent=c,this.additions.push(a),void(this._flagAdditions=!0)):(e=b.indexOf(this.additions,a),e>=0?this.additions.splice(e,1):(this.subtractions.push(a),this._flagSubtractions=!0),void delete a.parent))}var e=Math.min,f=Math.max,g=function(){a.Utils.Collection.apply(this,arguments),Object.defineProperty(this,"_events",{value:{},enumerable:!1}),this.ids={},this.on(a.Events.insert,this.attach),this.on(a.Events.remove,this.detach),g.prototype.attach.apply(this,arguments)};g.prototype=new a.Utils.Collection,g.constructor=g,b.extend(g.prototype,{attach:function(a){for(var b=0;b<a.length;b++)this.ids[a[b].id]=a[b];return this},detach:function(a){for(var b=0;b<a.length;b++)delete this.ids[a[b].id];return this}});var h=a.Group=function(){a.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this._children=[],this.children=arguments};b.extend(h,{Children:g,InsertChildren:function(a){for(var b=0;b<a.length;b++)i.call(this,a[b],this)},RemoveChildren:function(a){for(var b=0;b<a.length;b++)i.call(this,a[b])},OrderChildren:function(a){this._flagOrder=!0},MakeObservable:function(c){var d=a.Path.Properties.slice(0),e=b.indexOf(d,"opacity");e>=0&&(d.splice(e,1),Object.defineProperty(c,"opacity",{get:function(){return this._opacity},set:function(a){this._flagOpacity=this._opacity!=a,this._opacity=a}})),a.Shape.MakeObservable(c),h.MakeGetterSetters(c,d),Object.defineProperty(c,"children",{get:function(){return this._collection},set:function(c){var d=b.bind(h.InsertChildren,this),e=b.bind(h.RemoveChildren,this),f=b.bind(h.OrderChildren,this);this._collection&&this._collection.unbind(),this._collection=new g(c),this._collection.bind(a.Events.insert,d),this._collection.bind(a.Events.remove,e),this._collection.bind(a.Events.order,f)}}),Object.defineProperty(c,"mask",{get:function(){return this._mask},set:function(a){this._mask=a,this._flagMask=!0,a.clip||(a.clip=!0)}})},MakeGetterSetters:function(a,c){b.isArray(c)||(c=[c]),b.each(c,function(b){h.MakeGetterSetter(a,b)})},MakeGetterSetter:function(a,c){var d="_"+c;Object.defineProperty(a,c,{get:function(){return this[d]},set:function(a){this[d]=a,b.each(this.children,function(b){b[c]=a})}})}}),b.extend(h.prototype,a.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_flagOrder:!1,_flagOpacity:!0,_flagMask:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_mask:null,clone:function(a){a=a||this.parent;var c=new h;a.add(c);b.map(this.children,function(a){return a.clone(c)});return c.translation.copy(this.translation),c.rotation=this.rotation,c.scale=this.scale,c},toObject:function(){var a={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return b.each(this.children,function(b,c){a.children[c]=b.toObject()},this),a},corner:function(){var a=this.getBoundingClientRect(!0),b={x:a.left,y:a.top};return this.children.forEach(function(a){a.translation.subSelf(b)}),this},center:function(){var a=this.getBoundingClientRect(!0);return a.centroid={x:a.left+a.width/2,y:a.top+a.height/2},this.children.forEach(function(b){b.translation.subSelf(a.centroid)}),this},getById:function(a){var b=function(a,c){if(a.id===c)return a;if(a.children)for(var d=a.children.length;d--;){var e=b(a.children[d],c);if(e)return e}};return b(this,a)||null},getByClassName:function(a){var b=[],c=function(a,d){return-1!=a.classList.indexOf(d)?b.push(a):a.children&&a.children.forEach(function(a){c(a,d)}),b};return c(this,a)},getByType:function(b){var c=[],d=function(b,e){for(var f in b.children)b.children[f]instanceof e?c.push(b.children[f]):b.children[f]instanceof a.Group&&d(b.children[f],e);return c};return d(this,b)},add:function(a){a=a instanceof Array?a.slice():b.toArray(arguments);for(var c=0;c<a.length;c++)a[c]&&a[c].id&&this.children.push(a[c]);return this},remove:function(a){var c=arguments.length,d=this.parent;if(0>=c&&d)return d.remove(this),this;a=a instanceof Array?a.slice():b.toArray(arguments);for(var e=0;e<a.length;e++)a[e]&&this.children.ids[a[e].id]&&this.children.splice(b.indexOf(this.children,a[e]),1);return this},getBoundingClientRect:function(a){var c;this._update(!0);var d=1/0,g=-(1/0),h=1/0,i=-(1/0);return this.children.forEach(function(j){/(linear-gradient|radial-gradient|gradient)/.test(j._renderer.type)||(c=j.getBoundingClientRect(a),b.isNumber(c.top)&&b.isNumber(c.left)&&b.isNumber(c.right)&&b.isNumber(c.bottom)&&(h=e(c.top,h),d=e(c.left,d),g=f(c.right,g),i=f(c.bottom,i)))},this),{top:h,left:d,right:g,bottom:i,width:g-d,height:i-h}},noFill:function(){return this.children.forEach(function(a){a.noFill()}),this},noStroke:function(){return this.children.forEach(function(a){a.noStroke()}),this},subdivide:function(){var a=arguments;return this.children.forEach(function(b){b.subdivide.apply(b,a)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),this._flagOrder=this._flagMask=this._flagOpacity=!1,a.Shape.prototype.flagReset.call(this),this}}),h.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame"));

// color presets
var west = ["#035299", "#5d69b1", "#a48588", "#fa575d", "#a0a0a0", "#e5e5e5"];

var dallas = ["#18a8de", "#ee586e", "#1ed5c8", "#ff9ca8", "#38c555"];

var pastel = ["palevioletred", "#ae81ff", "burlywood", "darksalmon", "paleturquoise", "#e6db74"];

var neon = ["#ff0066", "#6600ff", "#ffff00", "#ff3300", "#ff0009"];

var exciting = ["#ffffff", "#fffff0", "#ffff00", "#fff000", "#ff0000", "#f00000", "#000000"];

// call id
var elem = $("#bg-container");
var params = {
    autostart : true, 
    width : $(document).width(), 
    height : $(document).height(),
};

// set colors to be used in fill of bg objects
var colors = pastel;

// жулек, наченай двежение \\ startGeneration
var two = new Two(params).appendTo(elem[0]);

// requirements
var bgSprite = [];
var particles = [];

var objects = $("object");
var count = objects.length;
objects.each(function(i, pushkin) {
  pushkin.onload = function() {
    var shape = two.interpret($(pushkin).contents().find("svg")[0]);
    shape.visible = false;
    bgSprite.push(shape);
    if (!--count) generateSprites();
  };
});

function generateSprites() {
  _(30).times(function() {  // set ~about~ how many objects you want at one time
    var shape = _.sample(bgSprite).clone();

    shape.fill = _.sample(colors);
    shape.scale = _.random(10, 20)*'.01'; // set size of bg objects by scaling original SVG
    shape.opacity = 0; 
    shape.visible = true;

    var opacity, step, stepX, stepY, initialX, initialY;
    shape.start = function() {
      stepX = _.random(-16, 16)/4; // set horizontal step amt
      stepY = _.random(-16, 16)/4; // set vertical step amt
      step = _.random(50, 200)/10000; // step incriment
      initialX = _.random(0,two.width); // spawn x-axis
      initialY = _.random(0,two.height); // spawn y-axis
      shape.translation.set(initialX,initialY); // gatekeep  
      opacity = -1.0; // initial opacity (recommend keep at -1.0)
    };
    shape.step = function() {
      if (shape.opacity <= 0) shape.start();
      opacity += step;
      shape.translation.x += stepX;
      shape.translation.y += stepY;
      shape.rotation += step;
      shape.opacity = 1 - Math.abs(opacity); // fadeIn animation
    };
    particles.push(shape);
  });
}

//я люблю квас
two.bind('update', function() {
    _.each(particles, function(child) {
        child.step();
    });
});